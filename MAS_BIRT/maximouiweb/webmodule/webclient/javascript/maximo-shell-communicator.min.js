!function(e){"function"==typeof define&&define.amd?define(undefined,e):e()}((function(){"use strict";const e="undefined"!=typeof global&&"[object global]"==={}.toString.call(global)?global:window;class Factory{constructor(e,t=!1){this.Klass=e,this.instance=void 0,this.instanceOptions=void 0,this.alwaysGlobal=t,this.onListeners=[],this.onProxy=null}get(){return this.alwaysGlobal?this.getGlobal():(this.instance||(this.instance=this.newInstance(this.instanceOptions)),this.instance)}getGlobal(){let t=this.Klass.globalId||this.Klass.name;if(e!==e.parent&&e.parent){if(e.parent[t]||(e.parent[t]=this.newInstance(this.instanceOptions)),e.parent[t].on&&e.parent[t].off){if(!this.onProxy){let n=this.onListeners;this.onProxy=Proxy.revocable(e.parent[t],{get(e,t,i){let s=Reflect.get(e,t,i);return"on"===t&&"function"==typeof s?(...t)=>{t.length>1&&n.push({eventName:t[0],callback:t[1]}),Reflect.apply(s,e,t)}:"off"===t&&"function"==typeof s?(...t)=>{if(t.length>1){let e=n.findIndex((e=>e.eventName===t[0]&&e.callback===t[1]));e>-1&&n.splice(e,1)}Reflect.apply(s,e,t)}:s}})}return this.onProxy.proxy}return e.parent[t]}return e[t]||(e[t]=this.newInstance(this.instanceOptions)),e[t]}setImplementation(e,t,n){this.Klass=e,this.instanceOptions=t,this.instance=n}newInstance(e){return new this.Klass(e)}}const t=["color: red","color: orange","color: blue","color: black; font-weight: bold","color: dark-grey; font-weight: bold"];const n=new Factory(class{constructor(e={}){this.log=e.log||console.log,this.logInColor=e.color,this.initialStackFrame=e.initialStackFrame instanceof Number?e.initialStackFrame:4,this.stackFrameCount=e.stackFrameCount instanceof Number?e.stackFrameCount:2}printImpl(e,n,...i){this.logInColor?((e,n,i,...s)=>{e(`%c${i}`,t[n],s)})(this.log,e,n,...i):this.log(n,...i)}print(e,t,n,i,s,...o){let r=(new Date).toISOString();if(e.logCaller){const a=(new Error).stack.split("\n").slice(this.initialStackFrame,this.initialStackFrame+this.stackFrameCount);e.context?this.printImpl(n,`${r}: [${t}]: [${e.context}]: [${i}]: ${s}`,...o,a):this.printImpl(n,`${r}: [${t}]: [${i}]: ${s}`,...o,a)}else e.context?this.printImpl(n,`${r}: [${t}]: [${e.context}]: [${i}]: ${s}`,...o):this.printImpl(n,`${r}: [${t}]: [${i}]: ${s}`,...o)}}),i=["ERROR"," WARN"," INFO","DEBUG","TRACE"],s=["ERROR","WARN","INFO","DEBUG","TRACE"];
/*
   * @license
   * Licensed Materials - Property of IBM
   * 5724-U18, 5737-M66
   * Copyright IBM Corporation. 2018,2024
   */class Log{constructor(e={}){this.level=e.level||Log.LEVEL_INFO,this.log=e.log||console.log,this.logCaller=!0===e.logCaller,this.logPrinter=e.logPrinter||n.get(),this.context=null,this.logOnlyOnce={},this.DISABLE_LOG=e.disabled}t(e,...t){this.print(Log.LEVEL_TRACE,e,...t)}tOnce(e,t,...n){this.logOnlyOnce[e]||(this.logOnlyOnce[e]=!0,this.t("ONCE-"+t,...n))}isTrace(){return Log.LEVEL_TRACE<=this.level}d(e,...t){this.print(Log.LEVEL_DEBUG,e,...t)}isDebug(){return Log.LEVEL_DEBUG<=this.level}i(e,...t){this.print(Log.LEVEL_INFO,e,...t)}isInfo(){return Log.LEVEL_INFO<=this.level}w(e,...t){this.print(Log.LEVEL_WARN,e,...t)}wOnce(e,t,...n){this.logOnlyOnce[e]||(this.logOnlyOnce[e]=!0,this.w("ONCE-"+t,...n))}isWarn(){return Log.LEVEL_WARN<=this.level}e(e,...t){this.print(Log.LEVEL_ERROR,e,...t)}eOnce(e,t,...n){this.logOnlyOnce[e]||(this.logOnlyOnce[e]=!0,this.e("ONCE-"+t,...n))}isError(){return Log.LEVEL_ERROR<=this.level}getLevel(e){if(!e)return;e=String(e).toUpperCase();let t=s.indexOf(e);return t<0&&(t=void 0),t}print(e,t,n,...s){this.DISABLE_LOG||e<=this.level&&this.logPrinter.print(this,i[e],e,t,n,...s)}setLogPrinterFromFactory(){this.logPrinter=n.get()}}Log.LEVEL_TRACE=4,Log.LEVEL_DEBUG=3,Log.LEVEL_INFO=2,Log.LEVEL_WARN=1,Log.LEVEL_ERROR=0;const o=new Log({disabled:{}.DISABLE_LOG});const r="JS-EventEmitter";class EventHolder{constructor(e,t,n=!1){this.event=e,this.func=t,this.once=n,this.name="EventEmitter"}run(...e){this.func(...e)}}class EventEmitter{constructor(e={}){this._events={},e.canThrowEventErrors&&(this.canThrowEventErrors=!0),this.logUnhandledEvents=e&&e.logUnhandledEvents}on(e,t,n=!1){if("string"!=typeof e)throw new Error("Error: .on() first arg needs to be a string but was "+typeof e);if("function"!=typeof t)throw new Error("Error: .on() second arg needs to be a function but was "+typeof t);let i=this._events[e];return i||(this._events[e]=i=[]),this._findIndex(i,t)<0?i.push(new EventHolder(e,t,n)):o.t(r,"Attempted to add a listener %s, but listener function already exists",e,t),o.t(r,"[%s]: register event handler for [%s]",this.name,e),this}once(e,t){return this.on(e,t,!0)}_findIndex(e,t){return e.findIndex((e=>e.func===t))}off(e,t){if("string"!=typeof e)throw new Error("Error: .off() first arg needs to be a string but was "+typeof e);if("function"!=typeof t)throw new Error("Error: .off() second arg needs to be a function but was "+typeof t);let n=this._events[e];if(n&&n.length){let i=this._findIndex(n,t);i>-1?n.splice(i,1):o.w(r,'Attempted to remove a listener from event "%s", but listener does not exist',e,t)}else o.t(r,"Attempted to remove listener from event %s but event does not exist",e);return this}_emit(e,t,n,i,...s){let a=[],l=!1;if(e&&e.length){l=!0;for(let l=0;l<e.length;l++){let h=e[l];o.t(r,"Handling event '%s' in %s:%s (function: %s)",i,this.constructor.name,this.name,h.func.name);try{t&&h.once&&a.push(h.func),n?h.run(i,...s):h.run(...s)}catch(e){if(o.w(r,"Unhandled error while dispatching event %s.  Listeners should not throw errors.  In instance %s:%s (function: %s)",i,this.constructor.name,this.name,h.func.name,e),this.canThrowEventErrors||s[0]&&s[0].throwError)throw e}}if(a.length)for(let e=0;e<a.length;e++)this.off(i,a[e])}return l}emit(e,...t){if("*"===e)throw new Error('Programming Error: you cannot emit the "*" event');let n=!1,i=this._events[e];i&&i.length&&(n=this._emit(i,!0,!1,e,...t)),i=this._events["*"],i&&i.length&&(n=this._emit(i,!0,!0,e,...t)||n),!n&&this.logUnhandledEvents&&o.t(r,'"%s" event was not handled in this instance (%s:%s)',e,this.constructor.name,this.name)}emitAsPromise(e,t,n){if(n||(n=this.emit.bind(this)),t||(t={}),!(i=t)||"object"!=typeof i||Array.isArray(i))throw new Error(`Programmer error: emitAsPromise requires that the message be an object for event '${e}' body ${t}`);var i;if(t.onResponse)throw new Error("Programmer error: You cannot set your own onResponse handler for emitAsPromise.  It will create one automatically.");return new Promise((i=>{t.onResponse=e=>{i(e)},n(e,t)}))}listenerCount(e){let t=this._events[e];return t?t.length:0}listeners(e){return this._events[e]}toJSON(){}}const a="JS-ShellCommunicator";const l=new Factory(class extends EventEmitter{configure(t,n){this.messageIdToken=100*Math.random(),n||(n=e),this.messageReceiver=t,t&&t.postMessage||o.e(a,"configure(): Invalid configuration. postMessageReceiver must have a postMessage() method, but this instance does not",t),this.onMessage=n,n&&n.addEventListener||o.e(a,"configure(): Invalid configuration. onMessageReceiver must have an addEventListener method, but this instance does not",n),this.configureMessageListener(this.onMessage)}emitLocal(e,t){super.emit(e,t)}emitAsPromiseLocal(e,t){return super.emitAsPromise(e,t,this.emitLocal.bind(this))}emit(e,t,n){this.messageReceiver&&this.messageReceiver.postMessage?this.messageReceiver.postMessage(JSON.stringify({id:e,message:t,type:"graphite",responseToken:n}),"*"):o.w(a,"The ShellCommunicator is not yet configured.  The following message is discarded",e,t)}nextIdToken(){return this.messageIdToken+=1,`M${(new Date).getTime()}-${this.messageIdToken}`}emitAsPromise(e,t){return new Promise((n=>{let i=this.nextIdToken();this.once(i,(e=>{n(e)})),this.emit(e,t,i)}))}configureMessageListener(e){e.addEventListener("message",(async e=>{try{if("string"==typeof e.data){if(e.data.startsWith("setImmediate$"))return;let t=JSON.parse(e.data);if("graphite"!==t.type||"graphite"===t.type&&!t.id)throw Error(`Invalid message. ${JSON.stringify(t)}`);if(void 0!==t.responseToken){let e=await this.emitAsPromiseLocal(t.id,t.message);this.emit(t.responseToken,e)}else this.emitLocal(t.id,t.message)}}catch(t){o.d(a,"Invalid cross frame communication for message",e.data,t)}}))}});window.MaximoIdleTimer=class{constructor({timeout:e=1800,countdown:t=30,cookieName:n="_user_inactivity_timeout",cookieDomain:i="",onIdleTimeoutWarning:s=(()=>{}),onIdleTimeout:o=(()=>{}),onRestart:r=(()=>{}),onCookieCleared:a=(()=>{})}){this.COOKIE_CHECK_INTERVAL=1e3,this.ACTIVITY_DEBOUNCE=500,this.COUNTDOWN_START=t,this.COOKIE_NAME=n,this.COOKIE_DOMAIN=i,this.TIMEOUT=e,this.onIdleTimeoutWarning=s,this.onIdleTimeout=o,this.onRestart=r,this.onCookieCleared=a,this.eventHandler=this.debouncedUpdateExpiredTime.bind(this),this.start()}startIdleUserDetectionInterval(){0!==this.TIMEOUT&&(this.updateUserInactivityTimeoutCookie(),this.countdown=this.COUNTDOWN_START,this.intervalHandler&&clearInterval(this.intervalHandler),this.intervalHandler=setInterval((()=>{const e=this.getUserInactivityTimeoutCookie();Number.isNaN(e)&&(this.onCookieCleared(),this.cleanUp());const t=Date.now();e<t?0===this.countdown?(this.onIdleTimeout(),this.cleanUp()):(this.onIdleTimeoutWarning(this.countdown),this.countdown=0===this.countdown?this.countdown:Math.max(this.COUNTDOWN_START-parseInt((t-(e-this.COOKIE_CHECK_INTERVAL))/1e3,10),0)):this.countdown<this.COUNTDOWN_START&&(this.onRestart(),this.countdown=this.COUNTDOWN_START)}),this.COOKIE_CHECK_INTERVAL))}getUserInactivityTimeoutCookie(){const e=document.cookie.split("; ").find((e=>e.split("=")[0]===this.COOKIE_NAME)),t=e?.split("=")[1];return parseInt(decodeURIComponent(t),10)}setUserInactivityTimeoutCookie(e,t){document.cookie=`${this.COOKIE_NAME}=${encodeURIComponent(e)};expires=${t};path=/;domain=${this.COOKIE_DOMAIN};${"https:"===window.location.protocol?"Secure;":""}`}updateUserInactivityTimeoutCookie(){const e=new Date(Date.now()+6048e5).toUTCString(),t=Date.now()+1e3*this.TIMEOUT;this.setUserInactivityTimeoutCookie(t,e)}debouncedUpdateExpiredTime(){const e=this.getUserInactivityTimeoutCookie(),t=!Number.isNaN(e),n=Date.now()<e;t&&n&&(this.debounceTimeoutHandler&&clearTimeout(this.debounceTimeoutHandler),this.debounceTimeoutHandler=setTimeout((()=>{this.updateUserInactivityTimeoutCookie()}),this.ACTIVITY_DEBOUNCE))}createUserActivityListeners(){this.cleanUpUserActivityListeners(),window.addEventListener("mousemove",this.eventHandler),window.addEventListener("mousedown",this.eventHandler),window.addEventListener("scroll",this.eventHandler),window.addEventListener("keydown",this.eventHandler),window.addEventListener("clientTimerEvent",this.eventHandler,!0),window.addEventListener("touchstart",this.eventHandler),window.addEventListener("touchend",this.eventHandler),window.addEventListener("touchmove",this.eventHandler),window.addEventListener("touchcancel",this.eventHandler)}cleanUpUserActivityListeners(){window.removeEventListener("mousemove",this.eventHandler),window.removeEventListener("mousedown",this.eventHandler),window.removeEventListener("scroll",this.eventHandler),window.removeEventListener("keydown",this.eventHandler),window.removeEventListener("clientTimerEvent",this.eventHandler),window.removeEventListener("touchstart",this.eventHandler),window.removeEventListener("touchend",this.eventHandler),window.removeEventListener("touchmove",this.eventHandler),window.removeEventListener("touchcancel",this.eventHandler)}start(){this.createUserActivityListeners(),this.startIdleUserDetectionInterval()}restart(){this.start()}cleanUp(){clearInterval(this.intervalHandler),this.cleanUpUserActivityListeners(),this.onIdleTimeoutWarning=()=>{}}},window.MaximoShellCommunicator=l}));
//# sourceMappingURL=maximo-shell-communicator.min.js.map
