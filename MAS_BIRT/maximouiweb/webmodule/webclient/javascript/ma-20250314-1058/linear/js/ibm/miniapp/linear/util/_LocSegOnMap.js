define(["dojo/_base/lang","dojo/_base/declare","dojo/dom-construct","dojo/_base/array","com/ibm/tivoli/maximo/miniapps/_MaximoIO"],function(f,l,p,g,m){return l([m],{clickedObj:null,linearOnMouseOverEvents:null,linearOnMouseOutEvents:null,map:null,linear:null,constructor:function(a){dojo.mixin(this,a);thisLocSegOnMap=this;this.linearOnMouseOverEvents=[];this.linearOnMouseOutEvents=[]},OnClick:function(a,b,c,e,k,f,g){console.debug("Clicked row: "+b+" col: "+c+" x: "+e+" y: "+k);this.map=g;if(null==
b||"Data"!=b.Kind)return!1;console.debug("OClick for row.Kind Data: {}",c);if("G"==c){e=a.GetGanttXY(b,c,e,k);this.clickedObj=a.GetGanttRunBox(b,c,e.RunIndex);a=null;var d;try{d=JSON.parse(this.clickedObj.Row.run)}catch(n){d=this.clickedObj.Row.run,log.warn("{} Could not get measure unit from clicked object",n)}finally{a=d[0].measureUnitId}if(null!=e&&null!=e.Type&&"line"!=e.Type){d="";var h;this.map&&this.map.isMapGraphite()||(h=this.map.map._params.units);switch(h){case "esriMeters":d="METER";break;
case "esriMiles":d="MILES";break;case "esriKilometers":d="KM";break;case "esriCentimeters":d="CM";break;case "esriMillimeters":d="MM";break;case "esriFeet":d="FEET";break;case "esriInches":d="INCHES";break;default:d=h}this.fetch("get_calculatedMeasure",{linearObjTargetInfo:{linearObjTarget:!0,id:"lvcTargetMapLayer",rowName:this.clickedObj.Row.name,rowId:this.clickedObj.Row.id,start:""+this.clickedObj.Start,end:""+this.clickedObj.End,measureUnitId:a,mapMeasure:d}}).then(function(a){thisLocSegOnMap.drawTargetMeasuresOnMap(a)});
return!0}}return!1},drawTargetMeasuresOnMap:function(a){if(this.map&&this.map.isMapGraphite())this.map.highlightLinearFeature(a);else{var b=null;require(["esri/layers/GraphicsLayer"],function(a){b=new a({id:"lvcTargetMapLayer"})});b.linearConfig=a;var c=this.map.map.getLayer(b.id);c&&this.map.map.removeLayer(c);1==dojo.config.fwm.debug&&console.debug("[Linear] Loading target layer ",b.id);0<this.linearOnMouseOverEvents.length&&(g.forEach(this.linearOnMouseOverEvents,f.hitch(this,function(a,b){dojo.disconnect(a)})),
this.linearOnMouseOverEvents=[]);0<this.linearOnMouseOutEvents.length&&(g.forEach(this.linearOnMouseOutEvents,f.hitch(this,function(a,b){dojo.disconnect(a)})),this.linearOnMouseOutEvents=[]);c&&b.clear();require(["ibm/tivoli/fwm/mxmap/linear/Linear"],function(a){null==thisLocSegOnMap.linear&&(thisLocSegOnMap.linear=new a({map:thisLocSegOnMap.map.map}),thisLocSegOnMap.linear.symbologyManager=thisLocSegOnMap.map.getSymbologyManager())});this.linear.setMeasureUnits(a.mapMeasure);var c=a.calculatedStartMeasure,
e=Number(a.calculatedEndMeasure)-Number(c);a=a.id;b.linearConfig.mapConfig=this.map.mapConf;this.map.mapConf.currentMbo.FC?this.linear.createTargetGraphics(this.map.mapConf.currentMbo.FC.geometry.paths,c,e,a,b,this.map.map):this.linear.createTargetGraphics(this.map.mapConf.currentMbo.autolocate.FC.geometry.paths,c,e,a,b,this.map.map);a=dojo.connect(b,"onMouseOver",f.hitch(this,function(a){}));this.linearOnMouseOverEvents.push(a);a=dojo.connect(b,"onMouseOut",f.hitch(this,function(a){var b=a.graphic;
setTimeout(f.hitch(this,function(){this.linear.disableHighlight(b)}),1E3)}));this.linearOnMouseOutEvents.push(a);this.map.map.addLayer(b)}},cleanUp:function(){var a=this.map.map.getLayer("lvcTargetMapLayer");a&&this.map.map.removeLayer(a)}})});
