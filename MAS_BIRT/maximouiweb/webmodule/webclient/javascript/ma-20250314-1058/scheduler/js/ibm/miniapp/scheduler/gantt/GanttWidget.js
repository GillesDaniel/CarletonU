define("dojo/_base/lang dojo/aspect dojo/_base/window dojo/dom-class dojo/on dojo/mouse dojo/_base/declare com/ibm/tivoli/maximo/miniapps/_MaximoIO com/ibm/tivoli/maximo/miniapps/_MaximoLog dojo/topic ibm/miniapp/scheduler/gantt/GanttActions dijit/Tooltip dojo/dom-geometry dijit/TooltipDialog dijit/popup dojo/json dojo/_base/array dojo/dom ibm/miniapp/scheduler/SingleGanttView".split(" "),function(f,y,z,A,K,L,C,D,e,v,E,M,w,F,x,r,B,G,H){var I=JSON.stringify([235,255,255]),J=JSON.stringify([224,244,
244]);return C([D,E,H],{constructor:function(a){var b=this;e.debug("Hooking into sendEvent to be able to close scheduler popup windows");this.aspectSendEventBefore=y.before(window,"sendEvent",function(a,d){try{"click"===a&&(b.closeDatePicker(),b._hideTooltip())}catch(h){e.debug("Scheduler encountered and error before sendEvent",h)}});this.aspectSetDialogPositionBefore=y.before(window,"setDialogPosition",function(a,b,h){try{var g=getElement(a+"_inner");null!=g&&g.click()}catch(t){e.debug("Scheduler encountered and error before setDialogPosition",
t)}});this.ERRORS={ERR_INVALID_CRAFT_SKILL:4,ERR_CONFLICT_DOUBLE_BOOKED:8,ERR_SCHEDULE_WINDOW:16,ERR_CAPABILITY:32,ERR_CONFLICT_NON_WORK:64};this.options=a||{};this.showCurrentDateLine=!0;this.REPLOCFINISHLINE=this.REPLOCSTARTLINE=this.FNLLINE=this.SNELINE="";this._tooltipTimeout=this.mxtargetbean=this.gridId=this._focusGanttObject=this._tooltip=this.mouseOutHandler=this.grid=null;this.ViewName="Gantt";this._noStateSave=!0;this.TAG="NotCreated";this.TIMEOUT=1E3;a&&(this.loglevel=a.loglevel);a&&a.messages&&
f.mixin(this.messages,a.messages);this._conflictRowColor="#"+a["ga.conflict.row.color"];this._pmreforecastpendingBG="#"+a["pm.reforecastpending.background"];this._pmreforecastpendingFG="#"+a["pm.reforecastpending.foreground"];this.usePriorityColors=!a.usestatuscolors;this.ganttDisableEdit=this.ganttDisableClicks=this.ganttDisableRenderers=!1;this.state={};this.lastMouseDownEvent=null;(this.automationEnabled=a.automationEnabled)?e.debug("{} GanttWidget created with Automation.  Performance may be degraded.",
this.TAG):e.debug("{} GanttWidget created",this.TAG);this.lastRowChangedStatus=this.lastRowChangedId=null;this.showLoadAvailNumbers=1},_parseResource:function(a){if(!a)return null;var b=a.lastIndexOf("(");return 0>b?a.trim():a.substring(0,b).trim()},_parseResources:function(a){if(!a)return null;var b="";if((a=a.split(","))&&a.length)for(var c=0;c<a.length;c++)b.length&&(b+=","),b+=this._parseResource(a[c]);return b},_removeOldGrid:function(){if(null!=this.grid){this.clearHandlers();e.debug("{} Cleaning up TreeGrids",
this.TAG);try{null!=this.mouseOutHandler&&this.mouseOutHandler.remove();this._hideTooltip();this.grid.Dispose();for(var a=!0,b=0;b<Grids.length;b++)if(Grids[b]){a=!1;break}a&&window.DisposeGrids();this.grid=null}catch(c){e.warn("{} TreeGrid clean up encountered an error",this.TAG,c)}this._firstRender=!1}},_getKeyPrefixName:function(){return"Ctrl"},_newGridID:function(){this.gridId="g"+Math.floor(1E4*Math.random()+1);this.TAG=this.options.TAG+"["+this.gridId+"]"},destroy:function(){this.aspectSendEventBefore&&
this.aspectSendEventBefore.remove();this.aspectSetDialogPositionBefore&&this.aspectSetDialogPositionBefore.remove();this._removeOldGrid();this.inherited(arguments)},progress:function(a){a?A.add(z.body(),"skd-waiting"):A.remove(z.body(),"skd-waiting")},_ioOptions:function(a){null!=this.mxtargetbean&&(a.mxtargetbean=this.mxtargetbean);return a},_createUI:function(){this._removeOldGrid();this._newGridID();this.inherited(arguments);this._initGANTT()},_mouseLeave:function(a){if(!this.DATE_SELECTION_IN_PROGRESS){if(a&&
(a.toElement||a.explicitOriginalTarget||a.srcElement)&&(a=a.toElement||a.explicitOriginalTarget||a.srcElement,(a=a.className||a.id)&&a.indexOf&&-1!=a.indexOf("Tooltip")))return;this._hideTooltip()}},_RefreshRowsToTop:function(a){null!=a&&(e.debug("{} refreshing row",this.TAG),this.grid.RecalculateRows(a,1),this.grid.Calculate(1,1))},_initGANTT:function(){e.info("{} Initializing Gantt",this.TAG);window.TreeGrid?this._createGANTT():e.error("{} This should not happen, TreeGrid would already be loaded!!",
this.TAG)},__DEBUG:function(a,b){e.debug("[{}]: TreeGrid Debug Message: ",b,arguments,a);return!0},canRender:function(){return!0},addCustomActions:function(a){},_createGANTT:function(){var a=this;if(this.canRender()){e.debug("{} grid.js loaded, creating/loading data",this.TAG);var b=a._newTreeGridOptions();b.Text=b.Text||{Url:a.toUrl("async_load_text",a._ioOptions({})),Format:"JSON"};b.Debug=b.Debug||"Problem,Error,IOError";b.Text.Cache=3;this.ganttDisableEdit||(b.Upload=b.Upload||{Url:a.toUrl("async_upload_changes",
a._ioOptions({appname:a.appname,projectid:a.projectid})),Type:"Changes",Format:"JSON",Xml:2});this.exportEnabled&&(b.Export=b.Export||{Name:"Export",Format:"xlsx"});this.customUiUrl&&b.Layout&&(e.debug("Using custome UI URL: {}",this.customUiUrl),b.Layout.Url=this.customUiUrl);this.customDataUrl&&(e.debug("Using custome DATA URL: {}",this.customDataUrl),b.Data.Url=this.customDataUrl);b.Layout&&b.Layout.Url&&(b.ExportPDF=b.ExportPDF||{Url:this.servletBase+"/utility/tg/ExportPdf.jsp",Param:{Source:"ExportPDF.html",
Layoutxml:b.Layout.Url,Dataxml:b.Data.Url},Type:"Gantt,Settings,Expanded,Selected,Changes"},a.Layoutxml||(a.Layoutxml=b.Layout.Url),a.Dataxml||(a.Dataxml=b.Data.Url));for(var c=["Data","Layout","Export","Text","Upload"],d=0;d<c.length;d++)b[c[d]]||(b[c[d]]={}),b[c[d]].Timeout=this.TIMEOUT,e.debug("{}: Set Default Timeout for {} to {} seconds",this.TAG,c[d],this.TIMEOUT);b.Data.Url?(a.grid&&this._removeOldGrid(),e.debug("{} Creating TreeGrid {} with Options",this.TAG,a.gridId,b),a.addCustomActions(a.gridId),
TGSetEvent("OnDataError",a.gridId,function(b,c,d,e,f){console.log("TreeGrid Data Error",d,e,f,a.domid);v.publish("miniapp.hideprogress",a.domid);sendEvent("showwarnings",a.appid);console.log("processed error")}),AddEvent("OnLoadError",a.gridId,function(b){v.publish("miniapp.hideprogress",a.domid);sendEvent("showwarnings",a.appid)}),0<this.loglevel&&AddEvent("OnDebug",a.gridId,f.hitch(a,a.__DEBUG)),this.ganttDisableRenderers||(AddEvent("OnGetGanttSideHtml",a.gridId,f.hitch(a,a.OnGetGanttSideHtml)),
AddEvent("OnGetGanttHtml",a.gridId,f.hitch(a,a.OnGetGanttBarHtml)),AddEvent("OnGanttTip",a.gridId,f.hitch(a,a.OnGanttTip)),AddEvent("OnGetGanttRunText",a.gridId,f.hitch(a,a.OnGetGanttRunHtml)),AddEvent("OnGetGanttRunSideText",a.gridId,f.hitch(a,a.OnGetGanttRunSideText)),AddEvent("OnGetClass",a.gridId,f.hitch(a,a.OnGetTableCellClass)),AddEvent("OnTip",a.gridId,f.hitch(a,a.OnTip))),this.ganttDisableEdit||(AddEvent("OnClick",a.gridId,f.hitch(a,a.OnClick)),AddEvent("OnRightClick",a.gridId,f.hitch(a,a.OnRightClick)),
AddEvent("OnSelect",a.gridId,f.hitch(a,a.OnSelectRow)),AddEvent("OnFocus",a.gridId,f.hitch(a,a.OnFocus)),AddEvent("OnIconClick",a.gridId,f.hitch(a,a.OnIconClick)),AddEvent("OnAfterColResize",a.gridId,f.hitch(a,a.OnAfterColResize)),AddEvent("OnAfterSectionResize",a.gridId,f.hitch(a,a.OnAfterSectionResize)),AddEvent("OnAfterValueChanged",a.gridId,f.hitch(a,a.OnAfterValueChanged)),AddEvent("OnValueChanged",a.gridId,f.hitch(a,a.OnValueChanged)),AddEvent("OnGanttChange",a.gridId,f.hitch(a,a.OnBeforeGanttChanged)),
AddEvent("OnGanttChanged",a.gridId,f.hitch(a,a.OnGanttChanged)),AddEvent("OnCalculateCell",a.gridId,f.hitch(a,a.OnCalculateCell)),AddEvent("OnGetHtmlValue",a.gridId,f.hitch(a,a.OnGetHtmlValue)),AddEvent("OnGetColor",a.gridId,f.hitch(a,a.OnGetColor)),AddEvent("OnGanttDragTip",a.gridId,f.hitch(a,a.OnGanttDragTip)),AddEvent("OnStartDragGantt",a.gridId,f.hitch(a,a.OnStartGanttDrag)),AddEvent("OnDragGantt",a.gridId,f.hitch(a,a.OnGanttDrag)),AddEvent("OnEndDragGantt",a.gridId,f.hitch(a,a.OnEndDragGantt)),
AddEvent("OnGanttRunDrop",a.gridId,f.hitch(a,a.OnGanttRunDrop)),AddEvent("OnDragGanttRun",a.gridId,f.hitch(a,a.OnDragGanttRun)),AddEvent("OnLoadCfg",a.gridId,f.hitch(a,a.OnLoadCfg)),AddEvent("OnCfgLoaded",a.gridId,f.hitch(a,a.OnCfgLoaded)),AddEvent("OnCfgSaved",a.gridId,f.hitch(a,a.OnCfgSaved)),AddEvent("OnGanttMainChanged",a.gridId,f.hitch(a,a.OnActivityChanged)),AddEvent("OnGanttRunBoxChanged",a.gridId,f.hitch(a,a.OnGanttRunBoxChanged)),AddEvent("OnSave",a.gridId,f.hitch(a,a.OnSave)),AddEvent("OnAfterSave",
a.gridId,f.hitch(a,a.OnAfterSave)),AddEvent("OnUpdateRow",a.gridId,f.hitch(a,a.OnUpdateRow)),AddEvent("OnUndo",a.gridId,f.hitch(a,a.OnUndo)),AddEvent("OnRedo",a.gridId,f.hitch(a,a.OnRedo)),AddEvent("OnDataSend",a.gridId,f.hitch(a,a.OnDataSend)),AddEvent("OnPrint",a.gridId,function(b,c,d){b=d;try{return e.debug("DOMID: {}, ",a.domid,document.getElementById(a.domid+"_outer")),d="<style>\n"+document.getElementById(a.domid+"_outer").getElementsByTagName("style")[0].innerHTML.replace(new RegExp("#"+a.domid,
"g"),"")+"\n</style>"+d}catch(k){return console.log(k),b}}),AddEvent("OnPrintFinish",a.gridId,function(a,b){}),AddEvent("OnKeyDown",a.gridId,function(b,c,d,e,f){d&&d.srcElement&&d.srcElement.id&&"nav_search_fld"==d.srcElement.id&&b.ActionBlur();a.keyEvent=d}),AddEvent("OnKeyUp",a.gridId,function(b,c,d,e,f){delete a.keyEvent}),AddEvent("OnStartDragGanttDependency",a.gridId,f.hitch(a,a.OnStartDragGanttDependency)),AddEvent("OnEndDragGanttDependency",a.gridId,f.hitch(a,a.OnEndDragGanttDependency)),AddEvent("OnDragGanttDependency",
a.gridId,f.hitch(a,a.OnDragGanttDependency)),AddEvent("OnMouseDown",a.gridId,f.hitch(a,a.OnMouseDown)),AddEvent("OnMouseUp",a.gridId,f.hitch(a,a.OnMouseUp)),AddEvent("OnShowMenu",a.gridId,f.hitch(a,a.OnShowColumnsMenu)),AddEvent("OnSaveMenu",a.gridId,f.hitch(a,a.OnColumnsFinishMenu)),AddEvent("OnLoadCustomCfg",a.gridId,f.hitch(a,a.OnLoadCustomCfg)),AddEvent("OnSaveCustomCfg",a.gridId,f.hitch(a,a.OnSaveCustomCfg)),TGSetEvent("OnGetSortValue",this.gridId,f.hitch(this,this.OnGetSortValue)),window[this.gridId+
"_SideIconClicked"]=function(b,c,d){a.OnSideIconClick(a.grid,a.GetRowById(c),d)}),AddEvent("OnDblClick",a.gridId,f.hitch(a,a.OnDblClick)),AddEvent("OnGanttMenuClick",a.gridId,f.hitch(a,a.OnGanttMenuClick)),AddEvent("OnRenderFinish",a.gridId,f.hitch(a,a.OnRenderFinish)),AddEvent("OnRenderPageFinish",a.gridId,f.hitch(a,a.OnRenderPageFinish)),AddEvent("OnGetAvailability",a.gridId,f.hitch(a,a.OnGetAvailability)),AddEvent("OnGetAvailabilityClass",a.gridId,f.hitch(a,a.OnGetAvailabilityClass)),TGSetEvent("OnZoom",
a.gridId,f.hitch(a,a.OnZoom)),TGSetEvent("OnExportInit",a.gridId,f.hitch(a,a.OnExportInit)),AddEvent("OnReady",a.gridId,f.hitch(a,a.OnReady)),this.attachExtraGridEvents(this.gridId),a.subscribeOn("skd.ui.new.grid",f.hitch(a,a.__OnNewGridRegistered)),this.subscribeOn("skd.ui.please-wait",f.hitch(this,this.__pleaseWait)),this.subscribeOn("skd.ui.zoom-to-fit",f.hitch(this,this.__zoomToFit)),this.subscribeOn("skd.refreshAssignment",f.hitch(this,this.__refreshAssignment)),this.subscribeOn("skd.reloadBody",
f.hitch(this,this.ReloadBody)),a.grid=TreeGrid(b,a.domNode,a.gridId),this.upgradeTGInstance(a.grid),e.debug("{} TreeGrid Created; Version: {}",a.TAG,Component.Version,a.grid)):e.info("{}: No Data Url.  Will wait for a DataUrl before continuing",this.TAG)}else e.debug("{} Unable to render,yet.",this.TAG)},OnExportInit:function(a,b,c,d){if(null!=d)return!1;for(var h in a.Rows)if(a=this.GetRowById(h),a.Filtered||a.CanExport)a.CanExport=a.Filtered&&0!=a.Filtered?2:1;return!1},OnGetAvailabilityClass:function(a,
b,c,d,h,g,e){if((null!=b._OBJECTNAME&&"TOOLITEM"==b._OBJECTNAME||"PLUSAZONE"==b._OBJECTNAME)&&null!=b.availcommon){for(var f=b.availcommon.slice(0,-1).split(";"),m=0,n=0;n<f.length;n++)var l=f[n].split("#"),l=parseFloat(l[2]),m=Math.max(m,l);if(d>m&&"loadcommon"==h)return"COGanttAvailabilityRed"}return this.inherited(arguments)},doubleToDuration:function(a,b){b||(a*=60);var c=a/60,d=Math.floor(c),c=Math.round(60*(c-d));60==c&&(d++,c=0);return 10>c?d+":0"+c:d+":"+c},OnGetAvailability:function(a,b,
c,d,h,g,e,f,m,n,l){if(this._showResourceValuesInHours&&"TOOLITEM"!==b._OBJECTNAME&&"PLUSAZONE"!==b._OBJECTNAME)if(1<d){var p=this.doubleToDuration(d,!0);d=p;g[0]=p}else g[0]="";0==this.showLoadAvailNumbers&&(g[0]="");this.inherited(arguments)},OnZoom:function(a,b,c,d){try{if(a&&a.Toolbar){var h=a.GetBodyWidth(2),g=a.GetBodyScrollWidth(2);e.debug(a.id+" OnZoom: {}: start: {}, end: {}, Width: {} ScrollWidth; {}",b,new Date(c),new Date(d),h,g);var f=a.Toolbar.ZoomOutDisabled;a.Toolbar.ZoomOutDisabled=
5>Math.abs(h-g)?1:0;f!=a.Toolbar.ZoomOutDisabled&&a.RefreshRow(a.Toolbar)}}catch(k){e.error("OnZoom Hook Failed",k)}},OnLoadCustomCfg:function(a,b,c){e.debug("Loading Custom CFG:",b);if(b)try{this.state=r.parse(b,!1),this.state||(this.state={})}catch(d){e.warn("Failed to restore custom state: ",b)}},OnSaveCustomCfg:function(a,b){this.state||(this.state={});a&&a.Filter&&(this.state.Filter||(this.state.Filter={}),this.state.Filter.Visible=a.Filter.Visible);var c=r.stringify(this.state);e.debug("Custom State",
c);return c},OnShowColumnsMenu:function(a,b){b&&b.Names&&(b.Names.g&&(b.Names.g.Text=this.messages.ganttChart),b.Names.panel&&(b.Names.panel.Text=this.messages.panel));if(("Print"==a.ACol||"PRINTPDF"==a.ACol)&&void 0!=this.state.savedPrintOpt&&null!=this.state.savedPrintOpt){var c=this.state.savedPrintOpt;if(null!=c){var d=c[0].value,c=c[1].value,h=b.Items[1].Items,g=b.Items[3].Items;if(null!=d)for(var e in h)h[e].Value=d[h[e].Name];if(null!=c)for(e in g)g[e].Value=c[g[e].Name]}}},OnColumnsFinishMenu:function(a,
b){if("Print"==a.ACol){var c=[],d={},h={},g=b.Items[1].Items,e=b.Items[3].Items,f;for(f in g)d[g[f].Name]=g[f].Value;for(f in e)h[e[f].Name]=e[f].Value;0<Object.keys(d).length&&c.push({key:"printColumns",value:d});0<Object.keys(h).length&&c.push({key:"ganttChart",value:h});this.state.savedPrintOpt=c}},__zoomToFit:function(a){e.debug("Handling ZoomToFit Message",a);a&&a.startTime&&a.endTime?(a.startTime==a.endTime&&(a.endTime+=1),this.ZoomTo(a.startTime,a.endTime)):e.debug("Apparently no data in the message to zoom to??")},
__pleaseWait:function(a){this.grid.ShowMessage(a||this.messages&&this.messages.pleasewait||"Please wait while we process the request")},label:function(a){var b=this.messages&&this.messages[a];b||(b="[scheduler#"+a+"]");return b},ShowTGMessage:function(a){e.debug("Showing Message: {}",a);this.grid.ShowMessage(a)},HideTGMessage:function(){e.debug("Hiding Message");this.grid.HideMessage()},OnMouseDown:function(a,b,c,d,h,g){e.debug("Mouse Down",g);this.lastMouseDownEvent=g;this.MouseDown=this.Dragging=
!0;if(g&&g.currentTarget&&g.currentTarget.className&&-1!==g.currentTarget.className.indexOf("COResizeGrid")||g&&g.target&&g.target.className&&-1!==g.target.className.indexOf("COResizeGrid"))return!0},OnMouseUp:function(a,b,c,d,h,g){e.debug("Mouse Up",g);this.MouseDown=this.Dragging=!1;if(g&&g.currentTarget&&g.currentTarget.className&&-1!==g.currentTarget.className.indexOf("COResizeGrid")||g&&g.target&&g.target.className&&-1!==g.target.className.indexOf("COResizeGrid"))return!0},OnGanttDragTip:function(a,
b,c,d,h,g,e,f,m,n,l){if(3==g)return f?DateToString(e,"h")+" - "+DateToString(f,"h"):DateToString(e,"h");if(1==g)return DateToString(e,"h")+" ("+this.doubleToDuration(m/60)+")";if(2==g)return DateToString(f,"h")+" ("+this.doubleToDuration(m/60)+")"},FireEvent:function(a,b){this.publishLater(a,b)},doUpdate:function(a){this.grid.StartUpdate();a(this.grid);this.grid.EndUpdate()},OnStartDragGanttDependency:function(a,b,c,d,h,g,f,k,m){e.debug("Start Dependency");if(f!=this._getKeyPrefixName()||1==b._DUMMY||
!(this.options.scheduler_plus_license||"WORKORDER"==b._OBJECTNAME&&b._PARENTID))return!0},OnDragGanttDependency:function(a,b,c,d,h,g,e,f,m,n){if(!this.options.scheduler_plus_license){if(h&&!h._PARENTID||b&&!b._PARENTID||h&&b&&b._PARENTID!=h._PARENTID||h&&b&&b._OBJECTNAME!=h._OBJECTNAME||h&&b&&b._REFOBJECTNAME!=h._REFOBJECTNAME||h&&h._DUMMY&&1==h._DUMMY)return-1}else if(h&&b&&b._OBJECTNAME&&h._OBJECTNAME&&b.WONUM&&h.WONUM&&b._OBJECTNAME==h._OBJECTNAME){if(this.isAncestor(b,h)||this.isDescendant(b,
h))return-1}else if(h&&h._DUMMY&&1==h._DUMMY)return-1},_lockAction:function(a,b){var c=this._GetSelectedRows(this.grid,"G",b);this._applyForEachRow(c,f.hitch(this,function(b){e.debug("before lock activity",a.Value,b,b.MODAPPOINTMENT);""!=a&&(b.mxLeftIconClass="skd-icon-appointment");"1"==b.MODRESOURCELOCK&&""!=a&&(b.mxLeftIconClass="skd-icon-appresourceloc");b.GGanttRunMove="All,Move,Selected,Entire,Vert,Mouse";b._READONLY_STARTEND=!0;""!=a&&this.SetValue(b,"MODAPPOINTMENT",!0,!0)}))},_unlockAction:function(a,
b){var c=this.grid.GetRowById("toolbar");if(null==c||"0"==c.LOCKSCH)c=this._GetSelectedRows(this.grid,"G",b),this._applyForEachRow(c,f.hitch(this,function(b){e.debug("before unlock activity",a.Value,b,b.MODAPPOINTMENT,b.APPTREQUIRED);"1"==b.APPTREQUIRED||"Y"==b.APPTREQUIRED||1==b.APPTREQUIRED||"true"==b.APPTREQUIRED?""!=a&&(b.mxLeftIconClass="skd-icon-requirement"):"1"==b.MODRESOURCELOCK&&""!=a?b.mxLeftIconClass="skd-icon-resourceloc":delete b.mxLeftIconClass;delete b.GGanttRunMove;delete b._READONLY_STARTEND;
""!=a&&this.SetValue(b,"MODAPPOINTMENT",!1,!0)}))},_reslockAction:function(a,b){var c=this._GetSelectedRows(this.grid,"G",b);this._applyForEachRow(c,f.hitch(this,function(b){e.debug("before lock activity",a.Value,b,b.MODRESOURCELOCK);""!=a&&(b.mxLeftIconClass="skd-icon-resourceloc");"1"==b.MODAPPOINTMENT&&""!=a&&(b.mxLeftIconClass="skd-icon-appresourceloc");b.GGanttRunMove="All,Move,Selected,Entire,Slide,Mouse";b._READONLY_ASSIGNMENT=!0;""!=a&&this.SetValue(b,"MODRESOURCELOCK",!0,!0)}))},_resunlockAction:function(a,
b){var c=this._GetSelectedRows(this.grid,"G",b);this._applyForEachRow(c,f.hitch(this,function(b){e.debug("before unlock activity",a.Value,b,b.MODRESOURCELOCK,b.APPTREQUIRED);"1"==b.APPTREQUIRED||"Y"==b.APPTREQUIRED||1==b.APPTREQUIRED||"true"==b.APPTREQUIRED?""!=a&&(b.mxLeftIconClass="skd-icon-requirement"):"1"==b.MODAPPOINTMENT&&""!=a?b.mxLeftIconClass="skd-icon-appointment":delete b.mxLeftIconClass;delete b.GGanttRunMove;delete b._READONLY_ASSIGNMENT;""!=a&&this.SetValue(b,"MODRESOURCELOCK",!1,!0)}))},
_lockBulkAction:function(){var a=this.grid.Rows,b=Object.entries(a);if(null!=a)for(var c=0;c<b.length;c++){var d=b[c][0];if("ASSIGNED"==Object.entries(a)[c][1]._INTERNALSTATUS||"WAITASGN"==Object.entries(a)[c][1]._INTERNALSTATUS)d=this.GetRowById(d),null!=d&&this._lockAction("",d)}},_reslockBulkAction:function(){var a=this.grid.Rows,b=Object.entries(a);if(null!=a)for(var c=0;c<b.length;c++){var d=b[c][0];"ASSIGNED"==Object.entries(a)[c][1]._INTERNALSTATUS&&(d=this.GetRowById(d),null!=d&&this._reslockAction("",
d))}},_unlockBulkAction:function(){var a=this.grid.Rows,b=Object.entries(a);if(null!=a)for(var c=0;c<b.length;c++){var d=b[c][0];if("ASSIGNED"==Object.entries(a)[c][1]._INTERNALSTATUS||"WAITASGN"==Object.entries(a)[c][1]._INTERNALSTATUS)d=this.GetRowById(d),null!=d&&this._unlockAction("",d)}},_resunlockBulkAction:function(){var a=this.grid.Rows,b=Object.entries(a);if(null!=a)for(var c=0;c<b.length;c++){var d=b[c][0];"ASSIGNED"==Object.entries(a)[c][1]._INTERNALSTATUS&&(d=this.GetRowById(d),null!=
d&&this._resunlockAction("",d))}},isDescendant:function(a,b){if(a&&b&&b._PARENTID){if(b._PARENTID===a._idx)return!0;if(b.parentNode)return this.isDescendant(a,b.parentNode)}return!1},isAncestor:function(a,b){return this.isDescendant(b,a)},OnEndDragGanttDependency:function(a,b,c,d,h,g,f,k,m,n){e.debug("END Dependency")},__OnNewGridRegistered:function(a){a&&a.grid&&a.grid!=this&&(this._otherGRID=a.grid,e.debug("{} On New Grid Registered",this.TAG,a))},_FixUI:function(){if(this._otherGRID){e.debug("{} Fixing Grids {}, {}",
this.TAG,this.grid.id,this._otherGRID.grid.id);var a=this;require(["dojo/window"],function(b){b=b.getBox();var c=G.byId("m397b0593-co3_0"),c=w.position(c,!1);e.debug("POSITIONS",b,c);b=b.h-(2*c.h+c.y)-60;c=b/2;e.debug("SIZES: usable: {}, top:{}, bottom: {}",b,c,c);delete a.grid.MaxVScroll;w.setContentSize(a.domNode,{h:c});delete a._otherGRID.grid.MaxVScroll;w.setContentSize(a._otherGRID.domNode,{h:c})})}else e.debug("{} Not Other Grid.  Can't Fix UI",this.TAG)},attachExtraGridEvents:function(a){},
OnSideIconClick:function(a,b,c){e.debug("SideIconClicked: {}",c,b);if(this[c])return this[c](a,b),!0;e.error("Nothing Handled Click Event for {}",c)},__ResourceFormula:function(a){return a._Resources||""},OnUndo:function(a,b,c,d,h){"Change"==b&&(this._UpdateRelatedColumn(a,c,d,c[d])&&a.RefreshGantt(1,"G"),this.state&&this.state.Filter&&this.state.Filter.Visible&&this.grid.DoFilter(),null!=this.lastRowChangedStatus&&(a.SetValue(c,"_UNCOMMITTED",this.lastRowChangedStatus,null),a.RefreshCell(c,"name"),
this.lastRowChangedStatus=this.lastRowChangedId=null))},OnRedo:function(a,b,c,d,h){"Change"==b&&(this.state&&this.state.Filter&&this.state.Filter.Visible&&this.grid.DoFilter(),this.OnRowChanged(a,c))},OnTip:function(a,b,c,d,h,g,e,f){return d},_LockDurationAction:function(a){e.debug("Locking Duration",a);this.grid.Cols.G.GanttEdit="MainMove,Dependency,DependencyTypes,DependencyLags,Run";this.grid.Cols.G.GanttRunResize=""},_UnlockDurationAction:function(a){e.debug("UnLocking Duration",a);this.grid.Cols.G.GanttEdit=
"All";this.grid.Cols.G.GanttRunResize="All"},_LockScheduleAction:function(a){e.debug("Locking Schedule",a);this.grid.Cols.G.GanttEdit="";this.grid.Cols.startTime.CanEdit="0";this.grid.Cols.endTime.CanEdit="0";this.grid.Cols.G.GanttRunResize="";this._lockBulkAction()},_UnlockScheduleAction:function(a){e.debug("UnLocking Schedule",a);this.grid.Cols.G.GanttEdit="All";this.grid.Cols.startTime.CanEdit="1";this.grid.Cols.endTime.CanEdit="1";this.grid.Cols.G.GanttRunResize="All";this._unlockBulkAction()},
_LockResourceAction:function(a){e.debug("Locking Schedule",a);this._reslockBulkAction()},_UnlockResourceAction:function(a){e.debug("UnLocking Schedule",a);this._resunlockBulkAction()},OnDragGanttRun:function(a,b,c,d,h,g,f,k,m,n,l,p,q){g=this.grid.GetRowById("toolbar");if(null!=g&&"1"==g.LOCKSCH)return!1;this.Dragging=!0;if(1===h)return a=a.GetGanttRunBox(b,c,d),b=this.GetRowById(a.Id),this.focusGanttBar(b),this._isReadOnly(b)?(e.debug("OnDragGanttRun: Readonly"),!1):b&&3!=m&&1==b._READONLY_DURATION||
b&&1==b._READONLY_STARTEND||b&&1==b._READONLY?!1:null},onMeasure:function(){var a=this.inherited(arguments);if(!a||!this.grid||0==this.grid.ResizingMain)return a;1==this.grid.ResizingMain&&(e.debug("{}: Removing Height From Size because dynamic resizing is enabled",this.TAG),delete a.h,delete a.height);return a},SetExtraClass:function(a,b){this.RemoveExtraClass(a);a.ExtraClass=b},RemoveExtraClass:function(a){a.ExtraClass&&delete a.ExtraClass},OnIconClick:function(a,b,c,d,h){"name"===c?(c=b.startTime,
b=b.endTime,a=0,null!=c&&null!=b&&(a=b-c),0==a&&(b=null),this.ZoomTo(c,b,-40,!0)):(a=b[c+"IconEventArgs"],null!=a&&(e.debug("OnIconClick: Icon Click: {}; Args: {}",c,b[c+"IconEventArgs"]),b=r.parse(a),e.debug("OnIconClick: ",b),null!=b&&this.OnContextMenuItemSelected(b,null)))},focusGanttObject:function(a,b,c,d,h,g){"Data"===b.Kind&&"G"==c&&(a=a.GetGanttXY(b,c,d,h),null!=a&&null!=a.Main?this.focusGanttBar(b):null!=a&&null!=a.RunId?this.focusGanttBar(this.GetRowById(a.RunId)):this.focusGanttBar(null))},
OnDataSend:function(a,b,c,d){if(b&&"Changes"===b.Type&&c&&-1!==c.indexOf('"Changes":[]'))return e.debug("Prevent Empty Changes",c),!0;if(b&&"Changes"===b.Type&&c&&this.isBatchingChanges)return this.isBatchingChanges=!1,!0},focusGanttBar:function(a){if(this.Dragging)this.focusGanttBarLater(a);else if(e.debug("Focus Now Dragging? {}",this.Dragging),!a||!a.IgnoreFocus)if(!a||0!==a.CanMove)if(!a||!this._focusGanttObject||a.id!=this._focusGanttObject.id){if(null!=this._focusGanttObject){e.debug("Unfocus: {}",
this._focusGanttObject.id);this._focusGanttObject.MILESTONE&&0!=this._focusGanttObject.MILESTONE||(this._focusGanttObject.GGanttClass=this._focusGanttObject._GGanttClassOld,this._focusGanttObject._SKDRunClass=this._focusGanttObject._SKDRunClassOld);try{this.grid.Recalculate(this._focusGanttObject,"G",1)}catch(b){return}this._focusGanttObject=null}if(null!=a){e.debug("Focus: {}",a.id);this._focusGanttObject=a;a.MILESTONE&&0!=a.MILESTONE||(a._GGanttClassOld=a.GGanttClass,a.GGanttClass=a.IsSummary?"SKDFocusSummary":
"SKDFocus",a._SKDRunClassOld=a._SKDRunClass,a._SKDRunClass="SKDFocus");try{this.grid.Recalculate(a,"G",1)}catch(b){return}"box"==a.Type?(this._removeRowColor(this.grid),this.grid.Focus(a.parentNode,"G")):this.grid.Focus(a,"G");this._focusGanttBarAdditionalActions(a)}}},_focusGanttBarAdditionalActions:function(a){},focusGanttBarLater:function(a){var b=this;this.invokeLater(function(){b.focusGanttBar(a)},50,"focus")},processToolbarIconClick:function(a,b,c,d,h,g){if(this[c+"Action"])this[c+"Action"](a,
b,c,d,h,g)},OnClick:function(a,b,c,d,h,g){this._hideTooltip();if(b&&"Toolbar"==b.Kind){e.debug("Toolbar Object",b,c,d,h,g);if(1==b[c+"Disabled"])return!0;this.processToolbarIconClick(a,b,c,d,h,g);return!1}if(b&&"Data"==b.Kind){if(("startTime"==c||"endTime"==c||"MXDURATION"==c)&&a&&a.Toolbar&&1===a.Toolbar.LOCKSCH)return!0;this._removeRowColor(a);this.shouldOnClickSelectRow(a,b,c)&&!g.altKey&&a.SelectRow(b,1);this.focusGanttObject(a,b,c,d,h,g)}return g.ctrlKey||g.shiftKey?!1:b&&"Data"==b.Kind&&g.altKey?
(this.OnShowTooltip(a,b,c,d,h,g),!1):g.metaKey?this.OnRightClick(a,b,c,d,h,g):!1},shouldOnClickSelectRow:function(a,b,c){return!1},OnShowTooltip:function(a,b,c,d,h,g){var f=this;if("Panel"!=c&&("name"!=c||g&&g.srcElement&&g.srcElement.id&&-1!=g.srcElement.id.indexOf("TGCell_"))&&"startTime"!=c&&"endTime"!=c&&"Data"===b.Kind){if("G"==c){var k=a.GetGanttXY(b,c,d,h);e.debug("Gantt Object",k);if(null!=k&&null!=k.Point)return this.fetch("async_get_tooltip_for_point",f._ioOptions({projectid:f.projectid,
id:k.Row.id,point_index:k.PointIndex})).then(function(a){f._showTooltip(a,g,k.Row)}),!1;if(null==k||null==k.Main)if(null!=k&&null!=k.RunId)b=this.GetRowById(k.RunId),e.debug("Using RUN BAR for ToolTip",k,k.RunId,b);else return null!=k&&"dependency"==k.Type?(e.debug("Using Dependency for ToolTip",k),"0"===k.DependencyFromBox?this._fetchDependencyTooltip(k.DependencyFrom,k.DependencyTo,g):this._fetchDependencyTooltip(k.DependencyFromBox,k.DependencyToBox,g)):(a=this.getDateForX(d),e.debug("Gantt Click at {} is date {} ({})",
d,a,(new Date(a)).toUTCString()),this.fetch("async_get_tooltip_for_date",f._ioOptions({projectid:f.projectid,id:b.id,col:c,date:a})).then(function(a){f._showTooltip(a,g,b)})),!1}this.fetch("async_get_tooltip",f._ioOptions({projectid:f.projectid,id:b.id,col:c})).then(function(a){f._showTooltip(a,g,b)})}},getDateForX:function(a,b){var c=0;return c=this.grid&&this.grid.Cols&&this.grid.Cols.G&&this.grid.Cols.G.GanttPaging?this.grid.RoundGanttDate(a,320):this.grid.GetGanttDate(a,b)},_fetchDependencyTooltip:function(a,
b,c){var d=this;this.fetch("async_get_tooltip_cpm",d._ioOptions({projectid:d.projectid,fromid:a,toid:b})).then(function(a){d._showTooltip(a,c)})},_adjustTooltipForScreenBounds:function(a,b,c,d){e.debug("Weather is finished rendering, adjusting tooltip location",a,b);if(!this.isElementInViewport(b.domNode)){e.warn("NOT IN THE VIEWPORT");var h=this;a.hide(b);a.open({popup:b,x:c,y:d,onCancel:function(){h._hideTooltip()}})}},_showTooltip:function(a,b,c){var d=this;e.debug("Have a Tooltip",a);if(null!=
a){d._tooltip=new F({content:a.htmlTip,style:"width: 100%",onMouseLeave:function(){}});d._tooltip.startup&&d._tooltip.startup();if((a=d._tooltip.domNode.querySelectorAll(".recordHover"))&&a[0]){a=a[0].parentNode;var h=document.createElement("div");h.innerHTML='<div class="skd-tt-iconclose"><a href="#" onclick="return false"><img src="dialogclose.gif"></a></div>';a.insertBefore(h,a.firstChild)}e.debug("Tooltip is visible at x: {}, y: {}",b.pageX,b.pageY);x.open({popup:d._tooltip,x:b.pageX,y:b.pageY,
onCancel:function(){d._hideTooltip()}});d._tooltip.on("click",function(a){d._hideTooltip()});c&&this.weatherEnabled()&&("ASSIGNMENT"!=c._OBJECTNAME&&"WORKORDER"!=c._OBJECTNAME?e.debug("Object Doesn't Support Weather: {}",c._OBJECTNAME):(e.debug("Weather Row",c),a=function(){d._adjustTooltipForScreenBounds(x,d._tooltip,b.pageX,b.pageY)},d._tooltip.domNode.querySelectorAll("#weather_tooltip_embedded")&&(h=this.getWeatherParams(c),e.debug("Weather Lookup Params",c),h.domId="weather_tooltip_embedded",
h.tz="GMT",h.onRenderFinish=a,this.publishTo("weather.embedded.update",h))))}},getWeatherParams:function(a){var b=a._OBJECTID,c=a._OBJECTNAME;a._ISTASK&&a.parentNode&&(e.debug("Using Weather from PARENT since this is a task."),b=a.parentNode._OBJECTID,c=a.parentNode._OBJECTNAME);"ASSIGNMENT"==a._OBJECTNAME&&(b=a._PARENTOBJID,c="WORKORDER");return{wonum:""+a.WONUM,objectid:b,objectname:c,start:a.startTime,end:a.endTime}},weatherEnabled:function(){return this.options.scheduler_plus_weather_license},
OnFocus:function(a,b,c,d,h,g){if(b&&b!=d&&"Data"==b.Kind)try{this._applyScheduleWindow(a,b)}catch(f){e.error("Error",f)}},_getSNLFNE:function(a){return a&&(a.SNECONSTRAINT||a.FNLCONSTRAINT||a.REPLOCSTARTDATE||a.REPLOCFINISHDATE)?a:a?a.parentNode:null},_applyScheduleWindow:function(a,b){var c=this;this.invokeLater(function(){c._applyScheduleWindowLater(a,b)},200,"_schedulewindow")},_applyScheduleWindowLater:function(a,b){if(b=this._getSNLFNE(b))e.debug("_applyScheduleWindow ROW",b),this.SNELINE=b.SNECONSTRAINT?
"#"+b.SNECONSTRAINT+"#Red;":"",this.FNLLINE=b.FNLCONSTRAINT?"#"+b.FNLCONSTRAINT+"#Red3;":"",this.REPLOCSTARTLINE=b.REPLOCSTARTDATE?"#"+b.REPLOCSTARTDATE+"#Blue;":"",this.REPLOCFINISHLINE=b.REPLOCFINISHDATE?"#"+b.REPLOCFINISHDATE+"#Blue3;":"",this._updateGanttLines()},_localToMaxTz:function(a){a=a.getTime();a-=-6E4*(new Date).getTimezoneOffset();a+=-1*this.GMT0TZOffset;a-=6E4*(new Date).getTimezoneOffset();return new Date(a)},_utcToTz:function(a){},_updateGanttLines:function(){if(null!=this.grid&&
null!=this.grid.Cols&&this.grid.Cols.G){var a=this.grid.Cols.G.GanttLines,b=this.SNELINE+this.FNLLINE+this.REPLOCSTARTLINE+this.REPLOCFINISHLINE,c=!1;if(this.showCurrentDateLine){var d=this._localToMaxTz(new Date);d.setSeconds(0);d.setMilliseconds(0);var h=this.getVisibleRange();h&&h.start&&h.end&&d>=h.start&&d<=h.end&&(b="#"+d.getTime()+"#Orange;"+b,c=!0)}""==b?null!=a&&(e.debug("Removing Gantt Line: {}",a),delete this.grid.Cols.G.GanttLines,c=!0):a!=b&&(e.debug("UPDATING GANTTLINE: {}",b),this.grid.Cols.G.GanttLines=
b,c=!0);c&&(e.debug("Refreshing Schedule Window Updates"),this.Refresh(1))}},_updateGanttLinesRepeat:function(){e.debug("{}: Refreshing Gantt Lines",this.TAG);this._updateGanttLines();this.showCurrentDateLine&&this.invokeLater(f.hitch(this,this._updateGanttLinesRepeat),6E4)},OnShiftSelectRow:function(a,b,c){return!0},OnSelectRow:function(a,b,c){this.selectionInProgress||(this.selectionInProgress=!0,a.HideTip(),a.CloseDialog(),delete this.selectionInProgress,this.LastSelectedRow=c?null:b)},OnShiftClickCell:function(a,
b){if(this.LastSelectedRow)this.grid.SelectRange(b,null,this.LastSelectedRow,null,this.LastSelectedRow.Selected);else{var c=b.Selected;this._applyToRow(b,[],function(b,h){a.SelectRow(b,null==c||0==c?1:0);return!0})}},getVisibleRange:function(){return this.getVisibleRangeForGrid(this.grid)},getVisibleRangeForGrid:function(a){var b=a.GetBodyWidth(2),c=a.GetScrollLeft(2),b=c+b;return{start:a.GetGanttDate(c,"G"),end:a.GetGanttDate(b,"G")}},getMillisecondsFerPixel:function(){var a=this.grid.GetGanttDate(0,
"G");return this.grid.GetGanttDate(1,"G")-a},SetValue:function(a,b,c,d){this.grid.SetValue(a,b,c,1)},OnAfterSave:function(a,b,c){e.debug("{}: OnAfterSave: {}",this.TAG,b);0<=b&&this.sendToBeSaved()},OnUpdateRow:function(a,b,c){if("LABOR"==b.FWMTYPE||"AMCREW"==b.FWMTYPE)b.Height=28,b.MaxHeight=28,a.UpdateRowHeight(b,!1),b.Selected&&(a.SelectRow(b,0,0,!0),a.SelectRow(b,1,0,!0))},OnSave:function(a,b,c){},OnGanttRunDrop:function(a,b,c,d,h,g,f,k,m,n,l,p,q,r,u){d&&(this.Dragging=!1);if(null==n||"G"!=p||
l&&(1==l._DUMMY||"Header"==l.Kind||"Filter"==l.Kind))return!1;h=b.id!=l.id;f=parseInt(q);if(!1===d){this.Dragging=!0;e.debug("START: OnGanttRunDrop: {}",q);this._dragFreely=!0;this._boxRow=null;if("G"==c){box=a.GetGanttRunBox(b,c,g);if(null==box)return!1;b=this.GetRowById(box.Id);this.focusGanttBar(b);this._boxRow=b;1==b._READONLY_STARTEND?f==box.Left?(b.GGanttRunMove="All,Move,Selected,Entire,Vert,Mouse",this._dragFreely=q):this._dragFreely="":this._isReadOnly(b)&&(1==b._READONLY?this._dragFreely=
!1:h&&f==box.Left?(b.GGanttRunMove="All,Move,Selected,Entire,Vert,Mouse",this._dragFreely=q):(e.debug("OnGanttRunDrop: Making Readonly"),this._dragFreely=""))}return this._dragFreely}if(0===d)return this.Dragging=!0,!1===this._dragFreely||l&&(!0===l._DUMMY||"true"==l._DUMMY)||"G"!=p||this._boxRow&&1==this._boxRow._READONLY_ASSIGNMENT&&b&&l&&b.id!=l.id||this._boxRow&&"WORKORDER"==this._boxRow._OBJECTNAME&&b&&l&&b.id!=l.id||this._boxRow&&"PM"==this._boxRow._OBJECTNAME&&b&&l&&b.id!=l.id?!1:this._dragFreely;
if(1===d){this.Dragging=!1;if(!1===this._dragFreely)return!1;e.debug("DROPPED: OnGanttRunDrop");if("G"==c){if(l&&(!0===l._DUMMY||"true"==l._DUMMY)||this._boxRow&&1==this._boxRow._READONLY_ASSIGNMENT&&b&&l&&b.id!=l.id||this._boxRow&&"WORKORDER"==this._boxRow._OBJECTNAME&&b&&l&&b.id!=l.id||this._boxRow&&"PM"==this._boxRow._OBJECTNAME&&b&&l&&b.id!=l.id)return!1;this.OnValidatePMsegmentDrop&&this.OnValidatePMsegmentDrop(b,l,this._boxRow);this.OnValidateAssignmentDrop&&this.OnValidateAssignmentDrop(b,
l,this._boxRow)}return this._dragFreely}},OnValueChanged:function(a,b,c,d,h,g){e.debug("OnValueChanged: col: {}, val: {}",c,d);if("WOPRIORITY"==c||"INTSHIFT"==c||"INTERRUPTIBLE"==c||"SNECONSTRAINT"==c||"FNLCONSTRAINT"==c||"TARGSTARTDATE"==c||"TARGCOMPDATE"==c||"MXDURATION"==c||"MILESTONE"==c||"SUPERVISOR"==c||"name"==c){if(b&&"Data"==b.Kind&&"MXDURATION"==c){g=b.startTime;var f=d;if("string"===typeof d){var k=f=0;d.includes(":")?(f=36E5*parseInt(d.split(":")[0]),k=6E4*parseInt(d.split(":")[1])):f=
36E5*parseInt(d);f+=k}k=h;if("string"===typeof h){var m=k=0;h.includes(":")?(k=36E5*parseInt(h.split(":")[0]),m=6E4*parseInt(h.split(":")[1])):k=36E5*parseInt(h);k+=m}f!=k&&null!=g&&null!=d&&(this.isBatchingChanges=!0,this.SetValue(b,"endTime",g+f,!0))}if("string"===typeof d&&h==d)return;this.SetValue(b,"_UNCOMMITTED",1,!0);this.grid.RefreshCell(b,"name")}a.Cols[c]&&a.Cols[c].RefreshOnChange&&(e.debug("Updating Linked Column: {} with {}",a.Cols[c].RefreshOnChange,d),b[a.Cols[c].RefreshOnChange]=d,
a.RefreshCell(b,a.Cols[c].RefreshOnChange));this._UpdateRelatedColumn(a,b,c,d);return d},_UpdateRelatedColumn:function(a,b,c,d){return a.Cols[c]&&a.Cols[c].RefreshOnChange?(e.debug("Updating Linked Column: {} with {}",a.Cols[c].RefreshOnChange,d),b[a.Cols[c].RefreshOnChange]=d,a.RefreshCell(b,a.Cols[c].RefreshOnChange),!0):!1},OnAfterValueChanged:function(a,b,c,d){},OnBeforeGanttChanged:function(a,b,c,d,h,g,e,f,m){},OnGanttChanged:function(a,b,c,d,h,g,e,f,m){"Run"!==d&&(this.OnRowChanged(a,b),this.sendToBeSaved())},
OnRowChanged:function(a,b){if(null==this.lastRowChangedStatus&&null==this.lastRowChangedId||this.lastRowChangedId!=b.id)this.lastRowChangedId=b.id,this.lastRowChangedStatus=b._UNCOMMITTED;b&&b.Kind&&"Data"===b.Kind&&null!=this.appname&&"GWORKASSIGN"!=this.appname&&(b._UNCOMMITTED=1,this.grid.RefreshCell(b,"name"))},OnCalculateCell:function(a,b,c,d,h,g){},_applyCfgStateDuringRender:function(a,b){a&&a.Toolbar&&0===a.Toolbar.TOGGLEDEPS&&(a.Cols.G.GanttDescendants="",a.RefreshGantt(255));a&&a.Toolbar&&
1===a.Toolbar.LOCKDUR&&this._updateLockDuration();a&&a.Toolbar&&1===a.Toolbar.LOCKSCH&&this._updateLockSchedule();a&&a.Toolbar&&1===a.Toolbar.LOCKRESOURCE&&this._updateLockResource()},OnRenderFinish:function(a){this.grid=a;this._firstRender?(this.EnableFilter(a),this.Refresh(255)):(this._firstRender=!0,this.EnableFilter(a),this.Refresh(255),e.debug("{} Has Been Rendered",this.TAG),this.waitlockid&&(e.debug("{} Sending waitlockcomplete message: {}",this.TAG,this.waitlockid),this.publishLater("miniapp.waitlockcomplete",
this.waitlockid)),this.publishLater("skd.ui.new.grid",{grid:this}),v.publish("miniapp.hideprogress",this.domid),e.debug("{} TreeGrid Version: {}, Text Version: {}, Defaults Version: {}",this.TAG,Component.Version,this.grid.TextVersion,this.grid.DefaultsVersion,this.grid));var b=this;this.invokeLater(function(){b.showCurrentDateLine&&b._updateGanttLinesRepeat()},500,"ganttlinesrepeat")},EnableFilter:function(a){this.state&&(a.Filter&&this.state.Filter?((a.Toolbar.FILTER=this.state.Filter.Visible)?
a.ShowRow(a.Filter):a.HideRow(a.Filter),a.RefreshRow(a.Filter)):a.RefreshRow(a.Toolbar),this._applyCfgStateDuringRender&&this._applyCfgStateDuringRender(a,this.state))},OnActivityChanged:function(a,b,c,d,h,g,e){},OnGanttRunBoxChanged:function(a,b,c,d){this.MouseDown=this.Dragging=!1},OnLoadCfg:function(a,b){e.debug("{} OnLoadCfg: {}",this.TAG,b);return!1},_updateLockDuration:function(){if(this.grid&&this.grid._LockDurationAction)try{e.debug("Lock Duration Applied...");var a=this.grid.GetRowById("toolbar");
this.grid._LockDurationAction(a)}catch(b){e.error("Failed to apply lock duration",b)}else e.debug("Lock Duration not ready, waiting..."),this.invokeLater(f.hitch(this,this._updateLockDuration),100,"_lockDuration")},_updateLockSchedule:function(){if(this.grid&&this.grid._LockScheduleAction)try{e.debug("Lock Schedule Applied...");var a=this.grid.GetRowById("toolbar");this.grid._LockScheduleAction(a)}catch(b){e.error("Failed to apply lock Schedule",b)}else e.debug("Lock Schedule not ready, waiting..."),
this.invokeLater(f.hitch(this,this._updateLockSchedule),100,"_lockSchedule")},_updateLockResource:function(){if(this.grid&&this.grid._LockResourceAction)try{e.debug("Lock Resource Applied...");var a=this.grid.GetRowById("toolbar");this.grid._LockResourceAction(a)}catch(b){e.error("Failed to apply lock Resource",b)}else e.debug("Lock Schedule not ready, waiting..."),this.invokeLater(f.hitch(this,this._updateLockResource),100,"_lockResource")},OnCfgLoaded:function(a,b){this.grid!==a&&(e.warn("OnCfgLoaded but, we have a different grid. Fixing."),
this.grid=a);var c=a.GetRowById("toolbar");c&&1==c.LOCKDUR&&this._updateLockDuration();c&&!c.LOCKDUR&&this.lockDuration&&this._updateLockDuration();c&&1==c.LOCKSCH&&this._updateLockSchedule();c&&!c.LOCKSCH&&this.lockSchedule&&this._updateLockSchedule();c&&1==c.LOCKRESOURCE&&this._updateLockResource();c&&!c.LOCKRESOURCE&&this.lockResource&&this._updateLockResource();e.debug("{}({}) OnCfgLoaded",this.ViewName,this.TAG)},OnSaveCfg:function(a,b){},OnCfgSaved:function(a,b){var c=this;this.invokeLater(function(){c.OnCfgSavedDeferred(a,
b)},100,"OnCfgSaved");return!0},OnCfgSavedDeferred:function(a,b){e.debug("Saving user state");if(!b||this.lastCfg==b)return e.debug("State Not Changed"),!0;this.lastCfg=b;this.fetch("async_upload_cookie",this._ioOptions({cfgid:a.CfgId,cookie:b})).then(function(a){});return!0},hasParentSelected:function(a){return a.parentNode?a.parentNode&&this.grid.IsSelected(a.parentNode)?!0:this.hasParentSelected(a.parentNode):!1},normalizeSelectedRows:function(a){for(var b=[],c=0;c<a.length;c++)this.hasParentSelected(a[c])||
b.push(a[c]);return b},OnEndDragGantt:function(a,b,c,d,h,g,e,f,m,n,l,p,q,r){this.Dragging=!1;b&&this.OnRowChanged(a,b);if(3==m){var u=[];!b.firstChild||1!=b._INTERRUPTIBLE&&b._PARENTID||this._applyToRow(b,1,function(b,c){0==b.Selected&&u.push(b);a.SelectRow(b,c);return!0});if((b=this._GetSelectedRows(this.grid,"G",b))&&1<b.length){this.moveToDateOffset(b,h-e);for(i=0;i<u.length;i++)a.SelectRow(u[i],0);return!0}}},OnStartGanttDrag:function(a,b,c,d,h,g,e,f,m,n,l,p,q,r){this.Dragging=!0;this._hideTooltip();
this.focusGanttBar(b);a=this.grid.GetRowById("toolbar");if(null!=a&&"1"==a.LOCKSCH||this._isReadOnly(b)||3!=m&&1==b._READONLY_DURATION||1==b._READONLY_STARTEND)return!0},OnGanttDrag:function(a,b,c,d,h,g,e,f,m,n,l,p,q,r){this.Dragging=!0},_isReadOnly:function(a){return null==a?!1:1==a._READONLY||1==a.MODAPPOINTMENT||"true"==a.MODAPPOINTMENT},_hideTooltip:function(){if(this.Dragging)this._hideTooltipLater();else{null!=this._tooltipTimeout&&window.clearTimeout(this._tooltipTimeout);if(null!=this._tooltip)try{x.hide(this._tooltip),
this._tooltip.destroy(),this._tooltip=null}catch(a){console.log("error closing tooltip")}this.closeDatePicker&&this.closeDatePicker()}},_hideTooltipLater:function(){this.invokeLater(f.hitch(this,this._hideTooltip),20,"_tooltip")},OnDblClick:function(a,b,c,d,h,g){this._hideTooltip();e.debug("{} DblClick {}",this.TAG,c);this.shouldDblClickSelectRow(a,b,c)&&a.SelectRow(b,1);if(b&&"Data"==b.Kind&&("startTime"==c||"endTime"==c||"MXDURATION"==c)&&a&&a.Toolbar&&1===a.Toolbar.LOCKSCH)return!0;if("name"===
c)a=b.startTime,b=b.endTime,c=0,null!=a&&null!=b&&(c=b-a),0==c&&(b=null),this.ZoomTo(a,b,-40,!0);else if("G"===c){if(a=a.GetGanttXY(b,c,d,h),null!=a&&null!=a.Type){e.debug("DblClick GANTT Object",a);if(a.RunId)return!0;this.ZoomTo(b.startTime,b.endTime)}}else"CRAFT"===c&&this._removeRowColor(a)},getDateFromLoad:function(a){if(!a)return null;if((a=a.split(";"))&&a.length&&(a=a[0].split("#"))&&a.length){a=a[1];if(!a)return null;if((a=a.split("~"))&&a.length)return a[0]}return null},OnRightClick:function(a,
b,c,d,h,g){this._hideTooltip();if(null!=b&&"Data"==b.Kind){this.focusGanttObject(a,b,c,d,h,g);this.eventPageX=g.pageX;this.eventPageY=g.pageY;e.debug("OnRightClick: {}",c);this.shouldRightClickSelectRow(a,b,c)&&a.SelectRow(b,1);a.Focus(b,c,null,!1);if("G"==c){var f=a.GetGanttXY(b,c,d,h);if(null!=f&&null!=f.Type&&"line"!=f.Type)this.OnActivityContextMenu(a,b,c,d,h,g);else if(g&&g.originalTarget&&g.originalTarget.className&&-1!==g.originalTarget.className.indexOf("skd-icon")||g&&g.target&&g.target.className&&
-1!==g.target.className.indexOf("skd-icon"))this.OnTableContextMenu(a,b,c,d,h,g);else return this.hideGanttZoomOptions()}else this.OnTableContextMenu(a,b,c,d,h,g);return!0}},hideGanttZoomOptions:function(){return!1},shouldRightClickSelectRow:function(a,b,c){return(a=a.GetSelRows())&&0<a.length?!0:!1},shouldDblClickSelectRow:function(a,b,c){return!1},_GetSelectedRows:function(a,b,c){var d=[];if("G"==b)if(b=a.GetGanttRunSelectedBoxes(null,b),0<b.length)for(a=0;a<b.length;a++){var h=b[a].Id;h&&(h=this.GetRowById(h),
null!=h&&d.push(h))}else d=a.GetSelRows();else if(d=a.GetSelRows(),2===d.length&&(b=a.GetGanttRunSelectedBoxes(null,"G"),0<b.length))for(a=0;a<b.length;a++)if(h=b[a].Id)h=this.GetRowById(h),null!=h&&d.push(h);b=!0;for(a=0;a<d.length;a++)if(null!=c&&d[a].id==c.id){b=!1;break}null!=c&&b&&d.push(c);return d},isResourceView:function(){return!1},GetSelection:function(a,b,c){var d={activities:[],resources:[]},h=this.isResourceView,g=a.GetGanttRunSelectedBoxes(null,"G");if(0<g.length)for(var e=0;e<g.length;e++){var f=
g[e].Id;f&&(f=this.GetRowById(f),null!=f&&(d.activities.push(f),f.parentNode&&h&&d.resources.push(f.parentNode)))}this._focusGanttObject&&d.activities.push(this._focusGanttObject);(a=a.GetSelRows())&&a.length&&(this.isResourceView()?d.resources=d.resources.concat(a):d.activities=d.activities.concat(a));c&&("box"==c.Type?(d.activities.push(c),this.isResourceView()&&d.resources.push(c.parentNode)):this.isResourceView()?d.resources.push(c):d.activities.push(c),d.current_row=c,d.current_row_parent=c.parentNode,
d.current_row_type=this.isResourceView?1:0);b&&(d.col=b,c&&"G"!=b&&(d.col_value=c[b]));return d},GetSelectionIds:function(a,b,c){var d={activities:[],resources:[]},h={};a=this.GetSelection(a,b,c);for(c=0;c<a.activities.length;c++)h[a.activities[c].id]||(d.activities.push(a.activities[c].id),h[a.activities[c].id]=1);h={};for(c=0;c<a.resources.length;c++)h[a.resources[c].id]||(d.resources.push(a.resources[c].id),h[a.resources[c].id]=1);a.current_row&&(d.current_row=a.current_row.id);a.current_row_parent&&
(d.current_row_parent=a.current_row_parent.id);d.current_row_type=this.isResourceView?1:0;d.col=b;d.col_value=a.col_value;return d},TGDateToTZDate:function(a){return(new Date(a+6E4*(new Date(a)).getTimezoneOffset())).getTime()},TZDateToTGDate:function(a){return a-6E4*(new Date).getTimezoneOffset()},TGDateToUserTZDate:function(a){return a+this.GMT0TZOffset},closeDatePicker:function(){},_GetSelectedRowIds:function(a,b,c){a=this._GetSelectedRows(a,b,c);c=b="";for(var d in a)b=b+c+a[d].id,c=",";return b},
OnTableContextMenu:function(a,b,c,d,h,g){e.debug("OnTableMenuContextMenu: {}",c,a.Cols[c]);var f=this;if(!a.Cols[c])return!1;value="G"==c?b.id:b[c];b=this.GetRow(a,b,c,d,h);var k=a.GetGanttXY(b,c,d,h);if(null!=k&&"dependency"==k.Type)this._EDIT_DEPENDENCY=k,e.debug("Dependency Menu Fetch for",k),this.fetch("async_get_table_context_menu",f._ioOptions({projectid:f.projectid,id:k.DependencyFrom,col:"dependency",value:k.DependencyTo+k.DependencyType})).then(function(e){f._ShowContextMenu(e,a,b,c,d,h,
g)});else if(g&&g.originalTarget&&g.originalTarget.className&&-1!==g.originalTarget.className.indexOf("skd-icon")||g&&g.target&&null!=g.target.className&&-1!==g.target.className.indexOf("skd-icon")){var m=-1<(g.originalTarget?g.originalTarget:g.target).className.indexOf("left")?"from":"to";this._EDIT_DEPENDENCY=k;e.debug("Dependency Menu Fetch for",k);this.fetch("async_get_table_context_menu",f._ioOptions({projectid:f.projectid,id:value,col:"multiple-dependency",value:m})).then(function(e){f._ShowContextMenu(e,
a,b,c,d,h,g)})}else{var n=this.GetSelectionIds(a,c,b),k=this._GetSelectedRowIds(a,c,b);e.debug("OnTableMenuContextMenu: Context Menu: Selection: {}",k,n);if(void 0==value)return!0;this.fetch("async_get_table_context_menu",f._ioOptions({projectid:f.projectid,id:k,selection:n,col:c,value:value})).then(function(e){e=f._AdditionalTableContextMenu(e,a,b,c,d,h,g);f._ShowContextMenu(e,a,b,c,d,h,g,n)})}return!0},_ShowContextMenu:function(a,b,c,d,h,g,f,k){if(a){var m=this;try{pos={Mouse:1,X:0,Y:0},this._currentContextRow=
c,b.HideTip(),b.CloseDialog(),e.debug("Dynamic Menu and Position",a,pos),this.automationEnabled&&e.debug("ShowMenu for Automation"),b.Dialog=b.ShowPopup(a,function(a){m.OnContextMenuItemSelected(a,c,k)})}catch(n){e.error("error processing menu",n,a,d,c)}}else e.debug("No Menu for {}",d,c)},_AdditionalTableContextMenu:function(a,b,c,d,h,g,f){e.debug("_AdditionalTableContextMenu: {}",d);if("name"==d||"G"==d)a=a||{Items:[]},e.debug("Adding Debug Menus"),0>=this.loglevel?(a.Items.push({Name:"-",Grid:b,
Row:c,Col:d,X:g,Y:g}),a.Items.push({Name:"Debug Item",Value:"_OnDebugItem",Grid:b,Row:c,Col:d,X:g,Y:g}),a.Items.push({Name:"Clear Saved State",Value:"_OnClearSavedState",Grid:b,Row:c,Col:d,X:g,Y:g}),a.Items.push({Name:"Fetch UI Model",Value:"_FetchUIModel",Grid:b,Row:c,Col:d,X:g,Y:g}),a.Items.push({Name:"Fetch Data Model",Value:"_FetchDataModel",Grid:b,Row:c,Col:d,X:g,Y:g}),a.Items.push({Name:"Reload Body",Value:"ReloadBody",Grid:b,Row:c,Col:d,X:g,Y:g}),a.Items.push({Name:"Reload Model",Value:"ReloadModel",
Grid:b,Row:c,Col:d,X:g,Y:g}),a.Items.push({Name:"Request Grid Refresh All",Value:"onRefreshRequested",Grid:b,Row:c,Col:d,X:g,Y:g}),a.Items.push({Name:"Load Alternate Model",Value:"_LoadAlternateModel",Grid:b,Row:c,Col:d,X:g,Y:g})):(a.Items.push({Name:"Clear Saved State",Value:"_OnClearSavedState",Grid:b,Row:c,Col:d,X:g,Y:g}),a.Items.push({Name:"Reload Body",Value:"ReloadBody",Grid:b,Row:c,Col:d,X:g,Y:g}));return a},_FetchUIModel:function(){window.open(this.grid.Data.Layout.Url)},_LoadAlternateModel:function(){var a=
window.prompt("Enter Comma Separated URLs for UI and Data");null!=a&&(a=a.split(","),this.customUiUrl=a[0],this.customDataUrl=a[1],this.onRefreshRequested())},_FetchDataModel:function(){window.open(this.grid.Data.Data.Url)},SetIDFromItem:function(a){if(1==a.Multi){var b=this._GetSelectedRowIds(this.grid,"G",null);if(null!=b&&""!=b)return b;e.warn("Item has Multi flag, but nothing is selected",a)}return a.id||a.Value},OnContextMenuItemSelected:function(a,b,c){var d=this;e.debug("OnContextMenuItemSelected",
a);if(a.Values&&a.Values.dialogname)"GOTO"!=a.Values.dialogname?this.OnShowMaximoDialog(a):this.OnGoToMaximoApplication(a);else if(this[a.Value])try{e.debug("Calling ContextMenu Handler: {}",a.Value),this[a.Value](a,b)}catch(h){e.error("Error While Invoking Internal Method for {}",a.Value,h)}else a.longOpMessage&&this.publishPleaseWait(a.longOpMessage),this.fetch("on_handle_context_menu_item",this._ioOptions({projectid:this.projectid,id:this.SetIDFromItem(a),value:a.Value,values:a.Values,selection:c})).then(function(c){d.progress(!0);
d[a.Value+"Reply"]?(e.debug(" handle_context_menu_item: Sending Reply To {}",a.Value+"Reply"),d[a.Value+"Reply"](c,a,b)):d.processServerResponse(c);(1==a.ClearSelection||c&&c.IO&&1==c.IO.ClearSelection)&&d.grid.ClearSelection();d.progress(!1)})},processServerResponse:function(a){if(a&&a.Changes)this.acceptChangesFromServer(a),this.sendToBeSaved();else if(a&&a.IO)if(e.debug("Handling Reply.IO",a),1E3==a.IO.Result)this.ReloadBody(),this.sendToBeSaved();else if(1001==a.IO.Result)this.sendToBeSaved();
else{if(0>a.IO.Result)return e.error("acceptServerResponse: Error: {}",a.IO.Result),!1;e.error("acceptServerResponse: OK Result: {}",a.IO.Result)}else e.debug("acceptServerResponse: have no reply to process",a);return!0},publishPleaseWait:function(a){this.publishTo("skd.ui.please-wait",a)},acceptChangesFromServer:function(a){a&&a.Changes?(e.debug("Begin Applying Changes from server",a.Changes),this.grid.AddDataFromServer(a),e.debug("Done Applying Changes from server")):e.warn("No Changes",a)},ReloadBody:function(a){null==
a&&(a=function(){e.debug("Reload Complete")});e.debug("Reloading Body");this.grid.ReloadBody(a)},ReloadModel:function(){this.grid.Reload(null,null,!1);this.sendToBeSaved()},OnShowMaximoDialog:function(a){e.debug("Show Maximo Dialog",a.Values);for(var b in a.Values)e.debug("addCommInput({},{})",b,a.Values[b]),addCommInput(b,a.Values[b]);e.debug("sendEvent({},{})",a.Values.dialogname,this.appname);sendEvent(a.Values.dialogname,this.appname,"")},OnGoToMaximoApplication:function(a){e.debug("Go To Maximo Application",
a.Values);for(var b in a.Values)e.debug("addCommInput({},{})",b,a.Values[b]),addCommInput(b,a.Values[b]);e.debug("sendEvent({},{})",a.Values.dialogname,this.appname);sendEvent("applink",this.appname,"")},_OnDebugItem:function(a){"G"==a.Col?e.debug("DEBUG GANTT ITEM",a.Row):e.debug("DEBUG ITEM {}",a.Row.name,a.Row)},_OnClearSavedState:function(){this.fetch("clear_saved_state")},OnActivityContextMenu:function(a,b,c,d,h,g){e.debug("OnActivityContextMenu: {}",b.id);return this.OnTableContextMenu(a,b,
c,d,h,g)},OnContextMenu:function(a,b,c,d){e.debug("OnContextMenu: {} {}",c,d)},OnAfterSectionResize:function(a,b){},OnAfterColResize:function(a,b,c,d){e.debug("{} Resized: {} by {}",this.TAG,b,d)},OnReady:function(a,b){e.debug("{} TreeGrid.OnReady being called: [start: {}]",this.TAG,b);this.upgradeTGInstance(a)},OnGanttMenuClick:function(a,b,c,d,h,g){if(h&&"ZoomWork"==h.Name)return e.debug("ZoomToWork",h),this.ZoomToWork(this.grid)},ZoomToWork:function(a,b,c,d){e.debug("ZoomToWork: focus: {}, test: {}, show: {}",
b,c,d);if(!c)return b={start:0,end:0},this._applyToRow(a.Body,b,function(a,b){a.startTime&&!a._HIDDEN&&(0==b.start?(b.start=a.startTime,b.startRow=a):a.startTime<b.start&&(b.start=a.startTime,b.startRow=a));a.endTime&&!a._HIDDEN?0==b.end?(b.end=a.endTime,b.endRow=a):a.endTime>b.end&&(b.end=a.endTime,b.endRow=a):a.startTime&&!a._HIDDEN&&(0==b.end?(b.end=a.startTime,b.endRow=a):a.startTime>b.end&&(b.end=a.startTime,b.endRow=a));return!0}),c=b.end-b.start,864E5>=c&&(b.start-=(864E5-c)/2,b.end=b.start+
864E5),e.debug("ZoomTo",b),b.start&&b.end?(c=a.GetGanttDate(0),d=a.GetGanttDate(a.Cols.G.Width),d=a.RoundGanttDate(d,1,null,null,"d"),b.start<c||b.end>d?a.ActionZoomFit():this.ZoomTo(b.start,b.end,null,!0)):e.warn("Nothing To ZoomTo"),!0},OnGetSortValue:function(a,b,c,d,e,g){if(!d&&b.firstChild)return this.OnGetSortValue(a,b.firstChild,c,b.firstChild[c],e,g);c&&"MXDURATION"==c&&(d=d.replace(":",""),d="000000".substring(0,6-d.length)+d);return d},upgradeTGInstance:function(a){a._GotoTodayToolbarAction=
f.hitch(this,this._GotoTodayToolbarAction);a._GotoSelectedDayToolbarAction=f.hitch(this,this._GotoSelectedDayToolbarAction);a._LockDurationAction=f.hitch(this,this._LockDurationAction);a._UnlockDurationAction=f.hitch(this,this._UnlockDurationAction);a._LockScheduleAction=f.hitch(this,this._LockScheduleAction);a._UnlockScheduleAction=f.hitch(this,this._UnlockScheduleAction);a._LockResourceAction=f.hitch(this,this._LockResourceAction);a._UnlockResourceAction=f.hitch(this,this._UnlockResourceAction);
a._ZoomToWeekToolbarAction=f.hitch(this,this._ZoomToWeekToolbarAction);a.ResourceFormula=f.hitch(this,this.__ResourceFormula);a.OnHideFilter=function(a){e.debug("OnHideFilter:  CLearing Filters...");a.ActionClearFilters();a.Toolbar.Expression="";a.RefreshRow(a.Toolbar);a.SearchExpression="";a.SearchRows("Mark,Filter")};a._FixUIAction=f.hitch(this,this._FixUI);a.FireEvent=f.hitch(this,this.FireEvent);a.Actions.OnShiftClick=f.hitch(this,this.OnShiftClickCell);a.Actions.OnShiftClickPanelSelect=f.hitch(this,
this.OnShiftSelectRow);var b=this;a.Actions.OnCtrlAltClick=function(a){e.LOG_LEVEL==e.DEBUG?(e.LOG_LEVEL=e.WARN,b.loglevel=e.WARN):(e.LOG_LEVEL=e.DEBUG,b.loglevel=e.DEBUG);e.warn("Debug Logging Changed: {}",e.LOG_LEVEL);try{a.Toolbar.ZoomVisible=0==e.LOG_LEVEL?1:0,a.RefreshRow(a.Toolbar)}catch(d){e.error("Debug Failed",d)}}},_createZoomRange:function(a,b){var c={},d=b-a;864E5>=d?(c.start=a-(864E5-d)/2,c.end=c.start+864E5):6048E5>=d?(c.start=a-(6048E5-d)/2,c.end=c.start+6048E5):(c.start=a-864E5,c.end=
b+864E5);return c},roundToStartOfDay:function(a){return a-a%864E5},ZoomTo:function(a,b,c,d){d=d||!1;a&&!b&&(e.debug("ZoomTo: Adjusting end because it is null"),b=this.roundToStartOfDay(a)+this.DURATION_ONE_DAY,d=!0);a&&b&&b-a<this.DURATION_ONE_DAY&&(a=this.roundToStartOfDay(a),b=a+this.DURATION_ONE_DAY,d=!0);e.debug("{} ZoomTo: {}, {}",this.TAG,new Date(a),new Date(b));if(!a||!b||null==a||null==b||0>=a||0>=b)e.warn("{} ZoomTo called with invalid start {} and end times {}",this.TAG,a,b);else{e.debug("{} Zooming Before Create Range: {} - {}",
this.TAG,new Date(a),new Date(b));range=!0===d?{start:a,end:b}:this._createZoomRange(a,b);e.debug("{} Zooming After Create Range: {} - {}",this.TAG,new Date(range.start),new Date(range.end));try{e.debug("{} Zooming: {} - {} (exact?: {}) (width: {})",this.TAG,new Date(range.start),new Date(range.end),d,c),this.grid.ZoomTo(new Date(range.start),new Date(range.end),-40)}catch(h){e.error("{} error during ZoomTo",this.TAG,h)}e.debug("{} Zoomed: {} - {}",this.TAG,new Date(range.start),new Date(range.end))}},
__rowValFunc:function(a,b){(val=this.row[b])||(val="");return val},OnGanttTip:function(a,b,c,d,e,g){a="{name}";"Run"===g&&e&&e.RunId&&(e=this.GetRowById(e.RunId))&&(b=e);e="gantt."+b._OBJECTNAME+".tip.tpl";null!=this[e]&&(a=this[e],null==a||0==a.trim().length)&&(a="{name}");e=f.replace(a,f.hitch({row:b},this.__rowValFunc));if(null==e||0==e.trim().length)e=b.name;return e},OnGetGanttBarHtml:function(a,b,c,d,e,g,t,k,m,n,l,p,q){a="{name}";c="gantt."+b._OBJECTNAME+".tpl";null!=this[c]&&(a=this[c],null==
a||0==a.trim().length)&&(a="{name}");a=f.replace(a,f.hitch({row:b},this.__rowValFunc));if(null==a||0==a.trim().length)a=b.name;if(!b.IsSummary){e=d="";d=null!=b._INTERNALSTATUS?"SKD"+b._OBJECTNAME+"_"+b._INTERNALSTATUS:"SKD"+b._OBJECTNAME;this.usePriorityColors&&b.WOPRIORITY&&(d="SKD"+b._OBJECTNAME+"_PRIORITY_"+b.WOPRIORITY);c=d+"-inner";b.STATUS&&(g="SKDSYN_"+b._OBJECTNAME+"_"+b.STATUS.toString().replace(/\s+/g,"-"),d+=" "+g,c+=" "+g+"-inner");if(b.ERRVAL){d="";0!=(b.ERRVAL&this.ERRORS.ERR_INVALID_CRAFT_SKILL)&&
(d="skd-InvalidSkillMap");if(0!=(b.ERRVAL&this.ERRORS.ERR_CONFLICT_DOUBLE_BOOKED)||0!=(b.ERRVAL&this.ERRORS.ERR_CONFLICT_NON_WORK))"ASSIGNED"==b._INTERNALSTATUS?d+=" skd-Conflict":1==b._READONLY&&(d+=" skd-Conflict");0!=(b.ERRVAL&this.ERRORS.ERR_SCHEDULE_WINDOW)&&(d+=" skd-err-schedule-window");""==d&&(d+=" skd-err")}b._ALTCLASS&&(e=b._ALTCLASS);t=1==b._READONLY?" skd-READONLY":"";k=1==b._READONLY_DURATION?" skd-READONLY_DURATION":"";m=1==b._READONLY_ASSIGNMENT?" skd-READONLY_ASSIGNMENT":"";n=1==
b._READONLY_STARTEND?" skd-READONLY_STARTEND":"";g=this._GetAltCSSClassForActivity(b)||"";d="skd-bar "+d+" "+e+" "+g+" "+n+k+m+t;c="skd-bar-inner "+c+" "+(g?g+"-inner ":"");e=null;this.GetBarStyle&&(e=this.GetBarStyle(b))&&(b="st-"+b.id,g=document.createElement("style"),g.type="text/css",g.innerHTML="."+b+" { "+e+" }",d+=" "+b);p||(p=[]);p[2]=d;p[3]=c}null!=a&&(a=a.replace(/\|/g,"&vert;"),a=a.replace(/\'/g,"&apos;"));return a},_GetAltCSSClassForActivity:function(a){if(swrow=this._getSNLFNE(a))if(swrow.SNECONSTRAINT&&
a.startTime<swrow.SNECONSTRAINT||swrow.FNLCONSTRAINT&&a.endTime>swrow.FNLCONSTRAINT||swrow.REPLOCSTARTDATE&&a.startTime<swrow.REPLOCSTARTDATE||swrow.REPLOCFINISHDATE&&a.endTime>swrow.REPLOCFINISHDATE)return cls="skd-InvalidSkillMap"},getVisibleStartDate:function(){var a=this.grid.GetScrollLeft(2),a=this.grid.GetGanttDate(a,"G");e.debug("Gantt Date: "+a);return a},getVisibleMidDate:function(){var a=this.grid.GetBodyWidth(2),a=this.grid.GetScrollLeft(2)+a/2;return this.grid.GetGanttDate(a,"G")},escape:function(a){return a.replace(/&/g,
"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},OnGetGanttSideHtml:function(a,b,c,d,e,g,f,k,m,n){return 1==n&&b&&b.mxLeftIconClass?((a=b.mxLeftIconTip)&&(a=' title="'+this.escape(a)+'"'),c="",b.mxLeftIconClick&&(c=" style='cursor: pointer;' onclick='window[\""+this.gridId+'_SideIconClicked"](this, "'+b.id+'", "'+b.mxLeftIconClick+"\")' "),'<i class="skd-icon-left '+b.mxLeftIconClass+'" '+a+c+">&nbsp;</i>"):2==n&&b&&b.mxRightIconClass?((a=b.mxRightIconTip)&&
(a=' title="'+this.escape(a)+"'"),c="",b.mxRightIconClick&&(c=" style='cursor: pointer;' onclick='window[\""+this.gridId+'_SideIconClicked"](this, "'+b.id+'", "'+b.mxRightIconClick+"\")' "),'<i class="skd-icon-right '+b.mxRightIconClass+'" '+a+c+">&nbsp;</i>"):null},OnGetTableCellClass:function(a,b,c,d){if("Data"===b.Kind){if("STATUS"==c)return d=null!=b._INTERNALSTATUS?"SKD"+b._OBJECTNAME+"_"+b._INTERNALSTATUS:"SKD"+b._OBJECTNAME,b.STATUS&&(a="SKDSYN_"+b._OBJECTNAME+"_"+b.STATUS.toString().replace(/\s+/g,
"-"),d+=" "+a),d;if("WOPRIORITY"==c){if(b.WOPRIORITY)return d="SKD"+b._OBJECTNAME+"_PRIORITY_"+b.WOPRIORITY}else if("name"==c&&b._UNCOMMITTED)return"skd-modified"}},OnGetGanttRunHtml:function(a,b,c,d,e,g,f,k,m,n){b=this.GetRowById(d[e][5]);if(null!=b){if(9<=d[e].length)var l=d[e][8];return this.OnGetGanttBarHtml(a,b,c,null,null,null,null,null,g,null,null,n,l)}},OnGetGanttRunSideText:function(a,b,c,d,e,g,f,k){if(void 0!=d[e][5]&&(b=this.GetRowById(d[e][5]),null!=b))return this.OnGetGanttSideHtml(a,
b,c,f,null,null,null,e,g,k)},GetRowById:function(a){var b=this.grid.GetRowById(a);b||"R"!=a.charAt(0)||(b=this.grid.GetRowById(a.substring(1)));return b},GetRow:function(a,b,c,d,e){if("G"!=c)return b;a=a.GetGanttXY(b,c,d,e);return null!=a&&null!=a.Type&&a.RunId?this.GetRowById(a.RunId):b},_newTreeGridOptions:function(){return{Data:{Url:this.toUrl("async_load_gantt_project",this._ioOptions({})),Timeout:300},Layout:{Url:this.toUrl("async_load_gantt_project_ui",this._ioOptions({appname:this.appname,
projectid:this.projectid}))}}},_applyMultiSkill:function(a,b){this._removeRowColor(a);e.debug("_applyMultiSkill",b);var c=b[0],d=b[1];if(c&&0<c.length)for(var f=0;f<c.length;f++){var g=this.GetRowById(c[f]);g.Color&&(g._OldColor=g.Color);g.Color="#64d9e7";g._MultiSkill=!0;a._MultiSkillRows.push(g);this.grid.RefreshRow(g)}if(d&&0<d.length)for(f=0;f<d.length;f++)g=this.GetRowById(d[f]),g.Color&&(g._OldColor=g.Color),g.Color="#bceef4",g._MultiSkill=!0,a._MultiSkillRows.push(g),this.grid.RefreshRow(g)},
_removeRowColor:function(a){a._MultiSkillRows||(a._MultiSkillRows=[]);var b=a._MultiSkillRows;if(b&&0!=b.length){e.debug("{}:_removeRowColor begin",this.TAG);for(var c in b){var d=b[c];d&&"Data"==d.Kind&&(delete d._MultiSkill,d._OldColor?(d.Color=d._OldColor,delete d._OldColor):delete d.Color,this.grid.RefreshRow(d))}a._MultiSkillRows=[];e.debug("{}: _removeRowColor end",this.TAG)}},_applyForEachRow:function(a,b){null!=a&&null!=b||e.error("_applyForEach requires a valid array of rows and action function");
for(var c=0;c<a.length;c++){var d=[];d.push(a[c]);if(2<arguments.length)for(var f=0;f<arguments.length;f++)d.push(arguments[f]);b.apply(this,d)}},_applyToRow:function(a,b,c){if(!a)return!0;if(c(a,b)){if(a.firstChild)for(a=a.firstChild;null!=a;){if(!this._applyToRow(a,b,c))return!1;a=a.nextSibling}return!0}return!1},_applyChanges:function(a){if(null!=a){var b=this;B.forEach(a,function(a){e.debug("ITEM: ",a);var d=b.GetRowById(a.id);d&&(B.forEach(Object.keys(a),function(b){"id"!=b&&(d[b]=a[b],e.debug("Setting {} = {}",
b,a[b]))}),b.grid.RefreshRow(d),e.debug("_applyChanges: {}",d,d._ASSIGNMENTDELETED),!0===d._ASSIGNMENTDELETED&&b.grid.DeleteRow(d,2),"PM"!=d._OBJECTNAME||"0"!=d.ALLSEGMENTSMOVABLE&&"N"!=d.ALLSEGMENTSMOVABLE&&0!=d.ALLSEGMENTSMOVABLE||(d.Color=this._pmreforecastpendingBG))});b.Refresh(255)}},Refresh:function(a){e.debug("{}: BEGIN RefreshGantt: {}",this.TAG,a);this.grid&&this.grid.RefreshGantt(a);e.debug("{}: END RefreshGantt: {}",this.TAG,a)},RefreshLater:function(a){var b=this;this.invokeLater(f.hitch(this,
function(){b.Refresh(a)}),100,"refresh_later")},visitRow:function(a,b,c){if(!a)return!0;if(c(a,b)){if(a.firstChild)for(a=a.firstChild;null!=a;){if(!this.visitRow(a,b,c))return!1;a=a.nextSibling}return!0}return!1},visitVisibleRow:function(a,b,c){if(!a)return!0;b.allRows||(b.allRows=[]);if(b.allRows.includes(a.id))return!1;b.allRows.push(a.id);if(c(a,b)){for(a=this.grid.GetFirstVisible(a);a;){if(!this.visitVisibleRow(a,b,c))return!1;a=this.grid.GetNextSiblingVisible(a)}return!0}return!1},visitVisibleChiden:function(a,
b){return this.visitVisibleRow(this.grid.Body.firstChild.firstChild,a,b)},__refreshAssignment:function(a){var b=a;"string"===typeof a&&(b=r.parse(a));if(b&&b.Changes&&b.Changes.length){a=b.Changes;this.grid.AddDataFromServer(b);for(b=0;b<a.length;b++){var c=a[b],d=this.grid.GetRowById(c.id);null!=d&&(null!=c._INTERNALSTATUS&&(d._INTERNALSTATUS=c._INTERNALSTATUS,d.STATUS=c.STATUS),d._OBJECTNAME=c._OBJECTNAME,d.WORKLOG=c.WORKLOG,d.WOPRIORITY=c.WOPRIORITY,d.TARGSTARTDATE=c.TARGSTARTDATE,d.TARGCOMPDATE=
c.TARGCOMPDATE,d.mxRightIconClass=c.mxRightIconClass,d.mxRightIconClick=c.mxRightIconClick,null!=c.TASKID&&(d.TASKID=c.TASKID),d.APPTREQUIRED=c.APPTREQUIRED,null!=c.MXDURATION&&(d.MXDURATION=c.MXDURATION),null!=c._OBJECTNAME&&"ASSIGNMENT"===c._OBJECTNAME&&(d._ASSIGNMENTID=c._ASSIGNMENTID,d.ISASSIGNMENT=c.ISASSIGNMENT,d._ASSIGNMENTCREW=c._ASSIGNMENTCREW,d._ASSIGNMENTCREWTYPE=c._ASSIGNMENTCREWTYPE,d._ASSIGNMENTSKILL=c._ASSIGNMENTSKILL,d._ASSIGNMENTCRAFT=c._ASSIGNMENTCRAFT,d._ASSIGNMENTLABOR=c._ASSIGNMENTLABOR),
null!=c._Resources&&(d._Resources=c._Resources),null!=c._WorkDay&&(d._WorkDay=c._WorkDay),null!=c.ORGID&&(d.ORGID=c.ORGID),d.GGanttBackground=c.GGanttBackground,d.IsSummary=c.IsSummary,d.ERRVAL=c.ERRVAL,this.grid.RefreshRow(d),null!=this.appname&&"schedacm"==this.appname&&(this.SetValue(d,"startTime",d.startTime,!0),this.SetValue(d,"endTime",d.endTime,!0),this.SetValue(d,"_UNCOMMITTED",1,!0)));d=c._OLDPARENTID;c=c.Parent;null!=d&&(d=this.grid.GetRowById(d),this.grid.RefreshRow(d));null!=c&&(c=this.grid.GetRowById(c),
this.grid.RefreshRow(c))}this.grid.RefreshGantt(1);null!=this.appname&&"rlassign"!=this.appname&&this.grid.ClearSelection();this.sendToBeSaved()}},OnGetHtmlValue:function(a,b,c,d){if("name"==c&&b._UNCOMMITTED&&1==b._UNCOMMITTED)return"* "+d},OnGetColor:function(a,b,c,d,e,g){if(!a.Cols[c]||!a.Cols[c].Visible)return null;var f=null;d=JSON.stringify([d,e,g]);if(I==d||J==d)f="white";if(a.Cols.G&&a.Cols.G.GanttZoom){var k=a.Cols.G.GanttZoom;d=a.GanttZoom.filter(function(a){return a.Name.includes(k)});
if(0<d.length&&d[0].GanttBackground)return b.GGanttBackground&&(delete b.GGanttBackground,this.RefreshGantt=!0),f}!this.ganttBackground&&a.Cols.G.GanttBackground&&(this.ganttBackground=a.Cols.G.GanttBackground.split("White").join("WORKAlternate"));"name"!=c||f||!b||!this.ganttBackground||!b._DATAGROUPNAME||b.GGanttBackground&&b.GGanttBackground==this.ganttBackground||(b.GGanttBackground=this.ganttBackground,this.RefreshGantt=!0);return f},OnRenderPageFinish:function(a,b){this.RefreshGantt&&(delete this.RefreshGantt,
a.RefreshGantt(1))}})});
