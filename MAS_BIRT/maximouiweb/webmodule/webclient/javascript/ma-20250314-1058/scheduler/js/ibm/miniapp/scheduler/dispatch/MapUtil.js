define(["dojo/_base/lang","dojo/_base/declare","com/ibm/tivoli/maximo/miniapps/_MaximoLog"],function(c,e,f){return e([],{constructor:function(a){this.dispatchView=null;c.mixin(this,a);f.debug("Dispatch Manager Map Facade")},attachToMap:function(a){console.log("attachToMap(): Attaching Map to Dispatch View",a);ibm.tivoli.fwm.mxmap.factory.setReadyToCreateMap(!0);require(["ibm/miniapp/scheduler/dispatch/DispatchManagerTG"],dojo.hitch(this,function(b){b=new b({map:a,applet:this.dispatchView});b.init();
window.dispatcher=b;try{console.info("attachToMap(): ok to execute methods on DispatchManager",dispatcher),this.dispatchView.setMapReady(!0),this.dispatchView._updateRoutes()}catch(d){console.warn("Attaching to map but applet is not yet there",d)}}))},checkForMap:function(){var a,b;a=dojo.subscribe("mxnmap_onTabOut",function(c){null!=a&&dojo.unsubscribe(a);null!=b&&dojo.unsubscribe(b)});var d=!1;try{if(ibm.tivoli.fwm.mxmap.factory&&ibm.tivoli.fwm.mxmap.factory.registry){console.log(ibm.tivoli.fwm.mxmap.factory.registry);
for(var c in ibm.tivoli.fwm.mxmap.factory.registry)d=this.attachToMap(ibm.tivoli.fwm.mxmap.factory.registry[c].currentMap)}}catch(g){}var e=this;0==d&&(b=dojo.subscribe("mxmap.mapLoaded",function(a,b,c){d=e.attachToMap(c)}))},verifyDispatchMapInRegistry:function(){if(ibm.tivoli.fwm.mxmap.factory.registry)for(var a in ibm.tivoli.fwm.mxmap.factory.registry)ibm.tivoli.fwm.mxmap.factory.registry[a].currentMap?(console.log("map found, going to subscribe and attach map"),ibm.tivoli.fwm.mxmap.dispatcher.checkForMap()):
(console.log("map not found, check again in half a second"),window.setTimeout(c.hitch(this,this.verifyDispatchMapInRegistry),500));else console.log("map registry not found, check again in half a second"),window.setTimeout(c.hitch(this,this.verifyDispatchMapInRegistry),500)}})});
