define("dojo/_base/declare com/ibm/tivoli/maximo/miniapps/_MaximoIO com/ibm/tivoli/maximo/miniapps/_MaximoLog dojo/_base/lang dojo/_base/array ibm/miniapp/scheduler/gantt/GanttWidget ibm/miniapp/scheduler/gantt/BaseResourceViewWidget ibm/miniapp/scheduler/gworkassign/GWAResourceViewActions dijit/popup".split(" "),function(q,r,e,l,n,t,u,v,m){return q([t,r,u,v],{constructor:function(a){this.ViewName="Assignments";this.initialized=!1;e.debug("{} Base Bean Target set to {} for view",this.gridId,this.mxtargetbean,
a)},attachExtraGridEvents:function(a){this.inherited(arguments);AddEvent("OnGetDefaultColor",a,l.hitch(this,this.OnGetDefaultColor));AddEvent("OnGanttChanged",a,function(b,a,d,k,f,h,g,e,l){b.ColorRow(a)});AddEvent("OnRowFilter",a,l.hitch(this,this.OnRowFilter));AddEvent("OnFilterFinish",a,l.hitch(this,this.OnFilterFinish));AddEvent("OnSelectGanttRunRect",a,l.hitch(this,this.OnSelectGanttObjects));window.Grids.FilterWork=function(b,a){if(!b.__FilterWorkData)return!0;for(var d=0;d<b.__FilterWorkData.length;d++)if(a.Resources==
b.__FilterWorkData[d])return!0;return!1};window.Grids.FilterCrewWorkGroup=function(b,a){for(var d=0;d<b.__FilterCrewWorkGroupData.length;d++)if(a.CREWWORKGROUP==b.__FilterCrewWorkGroupData[d])return!0;return!1};window.Grids.ZoomToWork=l.hitch(this,this.ZoomToWork);AddEvent("OnGetGanttHeader",this.gridId,l.hitch(this,this.OnGetGanttHeader));AddEvent("OnClickCell",this.gridId,l.hitch(this,this.OnClickCell));this.subscribeOn("skd.resourceview.rowselected",l.hitch(this,this._onFilterWorkForResource));
this.subscribeOn("skd.resourceview.filtered",l.hitch(this,this._onResourceViewFiltered));this.subscribeOn("skd.resourceview.loaded",l.hitch(this,this.filterResourceSection));this.subscribeOn("skd.refreshWorkView",l.hitch(this,this._refreshWork))},upgradeTGInstance:function(a){this.inherited(arguments);this.grid._previousWeek=l.hitch(this,this._previousWeek);this.grid._nextWeek=l.hitch(this,this._nextWeek);this.grid._enableFilterResourcesAction=l.hitch(this,this._enableFilterResourcesAction);this.grid._disableFilterResourcesAction=
l.hitch(this,this._disableFilterResourcesAction)},hideGanttZoomOptions:function(){return!0},OnClickCell:function(a,b,c,d){c=a.GetGanttXY(d.ClientX,d.ClientY);null==c||c.Main||a.SelectRow(b,0)},OnGetGanttHeader:function(a,b,c,d,k,f,h,g,e){1==c&&(b=DateToString(new Date((d+k)/2),"mmm yyyy"));3==c&&(b=DateToString(d,"ddd/dd"));return b},OnValueChanged:function(a,b,c,d,k,f){if(b&&("Filter"==b.Kind||"Filter"==b.id||"toolbar"==b.id))return this.inherited(arguments);e.debug("OnValueChanged: {}",d);if(("startTime"==
c||"endTime"==c)&&null!=d&&(d<this.projectStart||d>this.projectEnd)){var h=this.label("SelectedDateOutOfWorkListRange");a.ShowMessageTime(h,0,null,["OK"])}return k},OnAfterSave:function(a,b,c){this.inherited(arguments);0<=b&&this.publishLater("skd.workview.updated",{grid:a})},onRefreshRequested:function(a){this.inherited(arguments);this.publishLater("skd.workview.updated",{grid:this.grid,isRefresh:!0,currentWeek:this.startWeekDate})},OnGetDefaultColor:function(a,b,c,d,k,f){if("Data"==b.Kind&&"G"!=
c&&"Panel"!=c)return b.ERRVAL&&"name"==c?this._conflictRowColor:null},OnGanttRunBoxChanged:function(a,b,c,d){this.inherited(arguments)},OnValidateAssignmentDrop:function(a,b,c){},OnUndo:function(a,b,c,d,k){"Move"==b&&this.OnValidateAssignmentDrop(c.parentNode,c.parentNode,c)},OnFocus:function(a,b,c,d,k,f){a=0;this.grid.Cols.G.GanttLines&&""!=this.grid.Cols.G.GanttLines&&(this.grid.Cols.G.GanttLines="",a=1);a&&this.Refresh(a);return!1},OnDblClick:function(a,b,c,d,k,f){if(b&&("Filter"==b.Kind||"Filter"==
b.id||"toolbar"==b.id))return this.inherited(arguments);this._hideTooltip();e.debug("{} DblClick {}",this.TAG,c);var h=!0,h=null;null!=this.startWeekDate&&(h=this.startWeekDate+6048E5);if("name"==c&&"Filter"!=b.id){if(this.changingWeek)return!0;var g=b.startTime;(h=g<this.startWeekDate||g>h)&&(g<this.projectStart||g>this.projectEnd)&&this._rescheduleAction(b)}else if("G"===c){if(g=a.GetGanttXY(b,c,d,k),null!=g&&null!=g.Type){e.debug("DblClick GANTT Object",g);if(g.RunId)return!0;(h=b.startTime<this.startWeekDate||
b.startTime>h)&&this._gotoWeekDate(b.startTime)}}else"CRAFT"===c&&this._removeRowColor(a)},OnClick:function(a,b,c,d,k,f){this.inherited(arguments);if(f.ctrlKey||f.altKey||f.shiftKey)return!1;var h=null;null!=this.startWeekDate&&(h=this.startWeekDate+6048E5);if("name"==c&&null!=b.id&&"Filter"!=b.id){if(this.changingWeek)return!0;var g=b.startTime;if(moveToWeek=g<this.startWeekDate||g>h){if(g<this.projectStart||g>this.projectEnd)return!0;this._gotoWeekDate(g)}}if("G"===c){var e=this,h=this._GetSelectedRows(this.grid,
"G");null!=h&&1<h.length&&n.forEach(h,function(a){(null==b||null!=b&&b.id!=a.id)&&e.grid.SelectRow(a,0)});h=a.GetGanttXY(b,c,d,k);null!=h&&null!=h.Type&&h.RunId||this.OnFocus(a,b,c)}return!1},OnEndDragGantt:function(a,b,c,d,k,f,h,g,e,l,m,w,n,q){this.inherited(arguments);if(3==e){var p=this._GetSelectedRows(this.grid,"G",b);if(p&&1<p.length){for(i=0;i<p.length;i++)a.SelectRow(p[i],0);return!0}}},_focusGanttBarAdditionalActions:function(a){this.inherited(arguments);"Data"==a.Kind&&a._OBJECTNAME&&"WMASSIGNMENT"==
a._OBJECTNAME&&this.grid.Focus(null,null)},_GetAltCSSClassForActivity:function(a){if("undefined"!=a._INTERNALPLUSTQUALMET&&"ASSIGNED"==a._INTERNALSTATUS&&null!=a._INTERNALPLUSTQUALMET&&("NONE"==a._INTERNALPLUSTQUALMET||"PARTIAL"==a._INTERNALPLUSTQUALMET))return cls="skd-Conflict";if("ASSIGNED"===a._INTERNALSTATUS&&"ASSIGNREPLOC"===a._OBJECTNAME){if("undefined"!=a._INTPLUSARESERVATION&&null!=a._INTPLUSARESERVATION&&"HARD"===a._INTPLUSARESERVATION)return cls="skd-HardResType",e.debug("_GetAltCSSClassForActivity: {}",
cls,a._INTPLUSARESERVATION,a.PRIMARYFLAG),cls;if("undefined"!=a.PRIMARYFLAG&&null!=a.PRIMARYFLAG&&(0===a.PRIMARYFLAG||"N"===a.PRIMARYFLAG||!1===a.PRIMARYFLAG))return cls="skd-SecondaryAssignment"}return"ASSIGNED"===a._INTERNALSTATUS&&1==a._READONLY?cls="skd-FilteredAssignment":this.inherited(arguments)},_AdditionalTableContextMenu:function(a,b,c,d,k,f,h){var g=this.inherited(arguments);if("ASSIGNED"===c._INTERNALSTATUS&&1==c._READONLY){var e=g.Items.filter(function(b,a,c){return null!=b.Name&&b.Name.startsWith("Go To")});
g.Items=e}return g},OnRenderFinish:function(a){this.inherited(arguments);this.initialized=!0;var b=a.GetScrollLeft(2),b=a.GetGanttDate(b,"G");this._setWeekDate(b);a.Toolbar.PREVIOUSWEEKDisabled=b-6048E5<this.projectStart?1:0;a.Toolbar.NEXTWEEKDisabled=b+6048E5>this.projectEnd?1:0;1==a.Toolbar.LOCKDUR&&this._LockDurationAction();a.RefreshRow(a.Toolbar);var c=this;this.state&&(this.state.ResourceFilterEnabled&&(a.Toolbar.FILTERWORK=this.state.ResourceFilterEnabled,a.RefreshRow(a.FILTERWORK),this.invokeLater(function(){c._enableFilterResourcesAction()},
100,"EnableFilterResources")),a.RefreshRow(a.Toolbar))},OnLoadCfg:function(){return!1},_NotifyRowSelected:function(a,b,c,d,e,f,h,g){this.publishLater("skd.workview.rowselected",{grid:a,row:b,resourceFilterEnabled:this._ResourceFilterEnabled},100,"skd.workview.rowselected")},_onSyncResponse:function(){return!1},_updateSync:function(){return!1},requestSync:function(){return!1},focusGanttBarLater:function(){if(this.Dragging)return!1;this.inherited(arguments)},_setDateTimeAction:function(a,b,c){b=this._GetSelectedRows(this.grid,
"G",b);var d=this;c=this.TZDateToTGDate(c.getTime());var k=this._setDateFunction(c);this.grid.StartUpdate();var f=[];n.forEach(b,function(b,a){void 0!=b._READONLY&&b._READONLY||void 0!=b._READONLY_STARTEND&&b._READONLY_STARTEND||d._applyToRow(b,f,k)});this.grid.EndUpdate();e.debug("Moved {} rows",f.length);e.debug("Applied Set Date function {} to {} rows with date {}",a.Value,f.length,c)},_applyDatesFunction:function(a){var b=this;return function(c,d){if(null==c)return!1;if(0<=n.indexOf(d,c.id))return!0;
d.push(c.id);if((null==c.firstChild||0===c.firstChild.CanMove)&&c&&c.startTime){var e=b.grid.CheckGantt(c,"startTime",c.startTime+a);0!=e&&b.SetValue(c,"startTime",e)}return!0}},_onFilterWorkForResource:function(a){if(0==a.grid.LoadedCount)e.debug("Resource Grid is still loading, rescheduling filter for later execution"),this.publishLater("skd.resourceview.rowselected",{grid:a.grid,row:a.row,workFilterEnabled:a.workFilterEnabled},100,"skd.resourceview.rowselected");else{var b=a.grid.GetSelRows();
if(!0===a.workFilterEnabled&&b&&0<b.length){a=[];for(var c=0;c<b.length;c++)a.push(b[c].name);this.grid.__FilterWorkData=a;e.debug("{}: Applying Work Filter",this.TAG,a);this.grid.SetFilter("work","Grids.FilterWork(Grid,Row)","Resources",2)}else e.debug("{}: Removing Work Filter",this.TAG),this.grid.SetFilter("work",null,"Resources",2),delete this.grid.__FilterWorkData}},_onResourceViewFiltered:function(a){if(this.isVisible())if(a.grid.__FilterByResource){var b=null,c=null;0<a.grid.__FilterByResource.resources.size&&
(b=Array.from(a.grid.__FilterByResource.resources));0<a.grid.__FilterByResource.crewWorkGroups.size&&(c=Array.from(a.grid.__FilterByResource.crewWorkGroups));null==b&&null==c?(e.debug("{}: Removing Resource Filter",this.TAG),this.grid.SetFilter("work",null,"Resources",2),this.grid.SetFilter("work",null,"CREWWORKGROUP",2),delete this.grid.__FilterWorkData,delete this.grid.__FilterCrewWorkGroupData):(this.grid.__FilterWorkData=b,this.grid.__FilterCrewWorkGroupData=c,null!=b&&(e.debug("{}: Applying Resource Filter",
b),this.grid.SetFilter("work","Grids.FilterWork(Grid,Row)","Resources",2)),null!=c&&(e.debug("{}: Applying Resource Filter",c),this.grid.SetFilter("work","Grids.FilterCrewWorkGroup(Grid,Row)","CREWWORKGROUP",2)),delete a.grid.__FilterByResource)}else e.debug("{}: Removing Work Filter",this.TAG),this.grid.SetFilter("work",null,"Resources",2),this.grid.SetFilter("work",null,"CREWWORKGROUP",2),delete this.grid.__FilterWorkData,delete this.grid.__FilterCrewWorkGroupData},_previousWeek:function(){0==this.grid.Toolbar.PREVIOUSWEEKDisabled&&
this._gotoWeek(0)},_nextWeek:function(){0==this.grid.Toolbar.NEXTWEEKDisabled&&this._gotoWeek(1)},_gotoWeek:function(a){var b=this;this.fetch("_gotoWeek",b._ioOptions({direction:a})).then(function(a){a=a.startWeekDay;b.startWeekDate=a;var d=a+6048E5;b.grid.ZoomTo(a,d,1E3);b.publishTo("skd.workview.weekChange",{startWeekDay:a,endWeekDay:d});b.grid.Toolbar.PREVIOUSWEEKDisabled=a-6048E5<b.projectStart?1:0;b.grid.Toolbar.NEXTWEEKDisabled=a+6048E5>b.projectEnd?1:0;b.grid.RefreshRow(b.grid.Toolbar)})},
_gotoWeekDate:function(a){var b=this;this.changingWeek=!0;this.fetch("_gotoWeekDate",b._ioOptions({selectedDate:a})).then(function(a){a=a.startWeekDay;b.startWeekDate=a;var d=a+6048E5;b.grid.ZoomTo(a,d,1E3);b.publishTo("skd.workview.weekChange",{startWeekDay:a,endWeekDay:d});b.grid.Toolbar.PREVIOUSWEEKDisabled=b.startWeekDate-6048E5<b.projectStart?1:0;b.grid.Toolbar.NEXTWEEKDisabled=b.startWeekDate+6048E5>b.projectEnd?1:0;b.grid.RefreshRow(b.grid.Toolbar);delete b.changingWeek})},_setWeekDate:function(a){var b=
this;this.fetch("_setWeekDate",b._ioOptions({currentDate:a})).then(function(a){b.startWeekDate=a.startWeekDay})},OnLoadCustomCfg:function(a,b,c){this.inherited(arguments);this._ResourceFilterEnabled=this.state.ResourceFilterEnabled},OnSaveCustomCfg:function(a,b){this.state||(this.state={});a&&a.Filter&&(this.state.Filter||(this.state.Filter={}),this.state.Filter.Visible=a.Filter.Visible);this.state.ResourceFilterEnabled=this._ResourceFilterEnabled;var c=JSON.stringify(this.state);e.debug("Custom State",
c);return c},_enableFilterResourcesAction:function(){e.debug("{} Enable Filter Resources",this.TAG);this._ResourceFilterEnabled=!0;this._NotifyRowSelected(this.grid,null);this.grid.SaveCfg()},_disableFilterResourcesAction:function(){e.debug("{} Disable Filter Resources",this.TAG);this._ResourceFilterEnabled=!1;this._NotifyRowSelected(this.grid,null);this.grid.SaveCfg()},CanSelect:function(a){if(!a||!a.Visible||a.Hidden)return!1;if("gworkassign"==this.appname&&this.lastMouseDownEvent){if(this.lastMouseDownEvent.ctrlKey)return a&&
"WORKORDER"===a._OBJECTNAME;if(this.lastMouseDownEvent.altKey)return a&&"ASSIGNMENT"===a._OBJECTNAME}return!0},OnSelectGanttObjects:function(a,b,c,d,k,f,h){e.debug("OnSelectGanttObjects:");c=this.getDateForX(c,"G");for(f=this.getDateForX(f,"G");null!=b;)if((b.startTime>=c&&b.startTime<=f||b.endTime>=c&&b.endTime<=f||b.startTime<c&&b.endTime>f)&&this.CanSelect(b)&&a.SelectRow(b,1),b=a.GetNext(b),b===k){(b.startTime>=c&&b.startTime<=f||b.endTime>=c&&b.endTime<=f||b.startTime<c&&b.endTime>f)&&this.CanSelect(b)&&
a.SelectRow(b,1);break}},OnRowFilter:function(a,b,c){if(!this.grid.__FilterWorkData){this.grid.__FilterByWork||(this.grid.__FilterByWork={resources:new Set,crewWorkGroups:new Set});for(var d=[],e=0;e<a.GetFilter().length;e++)d.push(a.GetFilter()[e][0]);1==c&&(d.includes("Resources")&&b.Resources&&""!=b.Resources&&this.grid.__FilterByWork.resources.add(b.Resources),d.includes("CREWWORKGROUP")&&b.CREWWORKGROUP&&""!=b.CREWWORKGROUP&&this.grid.__FilterByWork.crewWorkGroups.add(b.CREWWORKGROUP))}},OnFilterFinish:function(a,
b){!this.grid.__FilterWorkData&&this.initialized&&(e.info("FilterBy Data: {}",this.grid.__FilterByWork),this.publishLater("skd.workview.filtered",{grid:a},100,"skd.workview.filtered"))},OnActivityChanged:function(a,b,c,d,e,f,h){this.grid.ShowMessage(this.messages.pleasewait,2,3)},OnUpdateRow:function(a,b,c){this.inherited(arguments);b._WorkDay=c._WorkDay},filterResourceSection:function(){this.grid.__FilterWorkData||(e.info("FilterBy Data: {}",this.grid.__FilterByWork),this.publishLater("skd.workview.filtered",
{grid:this.grid},100,"skd.workview.filtered"))},shouldOnClickSelectRow:function(a,b,c){return"G"==c?(null!=this.LastSelectedRow&&this.grid.SelectRow(this.LastSelectedRow,0),!0):!1},_GotoSeletedDateActionHandler:function(a,b,c){a=this.TZDateToTGDate(c.getTime());this._gotoWeekDate(a)},_showDatePickerAction:function(a,b,c,d){this.closeDatePicker&&this.closeDatePicker();var k=this.userinfo.calendarConstraints,f=this.getVisibleMidDate();null!=b&&(f=this._findEarliestStartDate(b));f||(f=(new Date).getDate());
var f=this.TGDateToTZDate(f),h=this,g;g=new c({lang:k.lang,lng:k.lng,dir:document.body.dir,constraints:k,value:f,maxHeight:"150",datePackage:k.datePackage,_close:function(){m.close(g);g.destroy();delete g},onChange:function(c){e.debug("OnChange: {}",c);var f=h.TGDateToUserTZDate(h.projectStart),g=h.TGDateToUserTZDate(h.projectEnd),k=c.getTime();k<f||k>g?(this._close(),c=h.label("SelectedDateOutOfWorkListRange"),h.grid.ShowMessageTime(c,0,null,["OK"])):(d(a,b,c),this._close())}});m.moveOffScreen(g);
g.startup&&g.startup();this.closeDatePicker=function(){try{m.close(g)}catch(a){}h.DATE_SELECTION_IN_PROGRESS=!1};this.DATE_SELECTION_IN_PROGRESS=!0;m.open({popup:g,x:this.eventPageX,y:this.eventPageY})},__refreshAssignment:function(a){this.inherited(arguments);this.grid.DoFilter();this.publishLater("skd.refreshResource",null);this.grid.ClearSelection()},_refreshWork:function(a){var b=this.grid.GetScrollLeft(2),b=this.grid.GetGanttDate(b,"G");this._setWeekDate(b);this.__refreshAssignment(a)},sendToBeSaved:function(){},
_rescheduleAction:function(a){e.debug("Selected row: {}",a);addCommInput("uniqueid",a._OBJECTID);addCommInput("actionname","reschedule");addCommInput("dialogname","reschedule");addCommInput("skdobjectname",a._OBJECTNAME);addCommInput("objectname",a._OBJECTNAME);addCommInput("eventtargetid","schacm_workview_viewer_miniapp");addCommInput("projectid",this.projectid);e.debug("sendEvent({},{})","reschedule",this.appname);sendEvent("reschedule",this.appname,"")}})});
