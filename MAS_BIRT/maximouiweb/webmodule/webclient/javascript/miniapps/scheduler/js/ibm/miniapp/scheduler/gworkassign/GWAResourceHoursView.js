define("dojo/_base/declare dojo/aspect com/ibm/tivoli/maximo/miniapps/_MaximoIO com/ibm/tivoli/maximo/miniapps/_MaximoLog dojo/_base/lang ibm/miniapp/scheduler/gantt/GanttWidget ibm/miniapp/scheduler/gantt/BaseResourceViewWidget com/ibm/tivoli/maximo/miniapps/Handlers ibm/miniapp/scheduler/gantt/CommonResourceHoursView".split(" "),function(q,r,t,k,m,u,v,w,y){return q([u,t,v,w,y],{constructor:function(b){k.debug("{} Base Bean Target set to {} for view",this.gridId,this.mxtargetbean,b);this.showCurrentDateLine=
!1;this.aspectShowHideElHandle=null;this.selectedModAvailReasonCode="";this.selectedModAvailDurationType="FULLDAY";this.selectedActivities="";this.topGanttSelected=!1;this.highlightedRows=[];this.highlightedRowsColor=new Map;this.highlightedCells=[]},_newTreeGridOptions:function(){return{Data:{Url:this.toUrl("async_load_project_data",this._ioOptions({})),Timeout:300},Layout:{Url:this.toUrl("async_load_project_ui",this._ioOptions({appname:this.appname,projectid:this.projectid}))}}},upgradeTGInstance:function(b){this.inherited(arguments);
AddEvent("OnGetGanttHeader",this.gridId,m.hitch(this,this.OnGetGanttHeader));this.grid._onChangeModAvailRsnCode=m.hitch(this,this._onChangeModAvailRsnCode);this.grid._onChangeModAvailDurationType=m.hitch(this,this._onChangeModAvailDurationType);this.grid._showLegendDialogAction=m.hitch(this,this._showLegendDialogAction)},addCustomActions:function(b){window.Grids.FilterResources=function(a,b){for(var d=0;d<a.__FilterResourcesData.length;d++)if(b.name.trim()==a.__FilterResourcesData[d].trim())return!0;
return!1};window.Grids.FilterResourcesCrewWorkGroup=function(a,b){for(var d=0;d<a.__FilterResourcesCrewWorkGroupData.length;d++)if(b.CREWWORKGROUP==a.__FilterResourcesCrewWorkGroupData[d])return!0;return!1}},hideGanttZoomOptions:function(){return!0},OnGetGanttHeader:function(b,a,c,d,f,h,g,e,l){3==c&&(a=DateToString(d,"ddd/dd"));return a},OnGanttTip:function(b,a,c,d,f,h){var g;if("CRAFT"==a._OBJECTNAME||"AMCREWT"==a._OBJECTNAME)return null;"Run"===h&&f&&f.RunId&&(g=this.GetRowById(f.RunId));b=null;
g=g.id.split("DAY").pop();if(a=a["MODAVAILINFO"+g])if(a=JSON.parse(a),a.length&&1<a.length)b=this.label("multipleModAvail");else{var e;null!=this["gantt.MODAVAIL.tip.tpl"]&&(e=this["gantt.MODAVAIL.tip.tpl"],null==e||0==e.trim().length)&&(e="{reasonCode} / {start}-{finish}");a=Object.assign({},a[0]);null!=a.duration&&(g=this.doubleToDuration(a.duration,!1),a.duration=g);b=m.replace(e,m.hitch({row:a},this.__rowValFunc));if(null==b||0==b.trim().length)b=a.reasonCode+(" / "+start+"-"+finish)}return b},
OnTableContextMenu:function(b,a,c,d,f,h){k.debug("OnTableMenuContextMenu: {}",c,b.Cols[c]);var g=this;if(!b.Cols[c])return!1;value="G"==c?a.id:a[c];a=this.GetRow(b,a,c,d,f);var e=b.GetGanttXY(a,c,d,f),l=this.GetSelectionIds(b,c,a),n=this._GetSelectedRowIds(b,c,a),m=a.START,e="LABOR"==a._OBJECTNAME||"AMCREW"==a._OBJECTNAME;"G"===c&&this.enableModAvail&&e&&(e=b.GetGanttXY(a,c,d,f),null!=e&&null!=e.Type&&e.RunId&&(n=e.RunId,"FULLWEEK"==this.selectedModAvailDurationType&&(n=n.replace(/.$/,"1")),m=this.GetRowById(n),
n=this._GetSelectedObjectIds(b,null,null),""==n&&(n=a._OBJECTID),k.debug("Selected Row: {}",m),m=m.START));k.debug("OnTableMenuContextMenu: Context Menu: Selection: {}",n,l);if(void 0==value)return!0;this.fetch("async_get_table_context_menu",g._ioOptions({projectid:g.projectid,id:n,selection:l,col:c,value:value,selecteddate:m})).then(function(e){e=g._AdditionalTableContextMenu(e,b,a,c,d,f,h);g._ShowContextMenu(e,b,a,c,d,f,h,l)});return!0},OnShowTooltip:function(b,a,c,d,f,h){var g=this;if("Panel"!=
c&&("name"!=c||h&&h.srcElement&&h.srcElement.id&&-1!=h.srcElement.id.indexOf("TGCell_"))&&"startTime"!=c&&"endTime"!=c&&"Data"===a.Kind){if("G"==c){var e=b.GetGanttXY(a,c,d,f);k.debug("Gantt Object",e);if(null!=e&&null!=e.Point)return this.fetch("async_get_tooltip_for_point",g._ioOptions({projectid:g.projectid,id:e.Row.id,point_index:e.PointIndex})).then(function(a){g._showTooltip(a,h,e.Row)}),!1;if(null==e||null==e.Main)if(null!=e&&null!=e.RunId)a=this.GetRowById(e.RunId),k.debug("Using RUN BAR for ToolTip",
e,e.RunId,a);else return null!=e&&"dependency"==e.Type?(k.debug("Using Dependency for ToolTip",e),"0"===e.DependencyFromBox?this._fetchDependencyTooltip(e.DependencyFrom,e.DependencyTo,h):this._fetchDependencyTooltip(e.DependencyFromBox,e.DependencyToBox,h)):(b=this.getDateForX(d),k.debug("Gantt Click at {} is date {} ({})",d,b,(new Date(b)).toUTCString()),this.fetch("async_get_tooltip_for_date",g._ioOptions({projectid:g.projectid,id:a.id,col:c,date:b})).then(function(b){g._showTooltip(b,h,a)})),
!1}b=this.getDateForX(d);d=a.id;if("LABOR"==a._OBJECTNAME||"AMCREW"==a._OBJECTNAME)d=a._PARENTID;this.fetch("async_get_tooltip",g._ioOptions({projectid:g.projectid,id:d,col:c,date:b})).then(function(b){g._showTooltip(b,h,a)})}},_onChangeModAvailRsnCode:function(b){this.selectedModAvailReasonCode=b},_onChangeModAvailDurationType:function(b){this.selectedModAvailDurationType=b},_onSaveModAvailRsnCode:function(b,a,c){var d=this;this.grid.ShowMessage(this.messages.pleasewait,2,3);this.fetch("async_save_modavail_rsncode",
d._ioOptions({projectid:d.projectid,selection:b,objectName:a,date:c,reasonCode:this.selectedModAvailReasonCode,durationType:this.selectedModAvailDurationType})).then(function(){null!=d.lastCfg&&d.grid.LoadCfg(d.lastCfg);d.grid.ReloadBody(function(){d.grid.ClearSelection()});d.clearReasonCode&&(d.selectedModAvailReasonCode="",d.grid.Toolbar.MODAVAILRSNCODE="",d.grid.RefreshRow(d.grid.Toolbar))})},_onDeleteModAvailRsnCode:function(b,a,c){var d=this;this.grid.ShowMessage(this.messages.pleasewait,2,3);
this.fetch("async_delete_modavail_rsncode",d._ioOptions({projectid:d.projectid,selection:b,objectName:a,date:c,durationType:this.selectedModAvailDurationType})).then(function(a){1E3<=a.IO.Result?(null!=d.lastCfg&&d.grid.LoadCfg(d.lastCfg),d.grid.ReloadBody(function(){d.grid.ClearSelection()}),d.clearReasonCode&&(d.selectedModAvailReasonCode="",d.grid.Toolbar.MODAVAILRSNCODE="",d.grid.RefreshRow(d.grid.Toolbar))):(d.HideTGMessage(),d.grid.ShowMessageTime("There is no modified availability to be removed.",
0))})},onWorkViewReferenceReceived:function(b){k.debug("Got a Work View Reference'",b);b.grid&&(this.linkedWorkViewGrid=b.grid,this.linkedWorkView=b.view,this._workviewChanged())},_GetSelectedObjectIds:function(b,a,c){b=this._GetSelectedRows(b,a,c);var d=a="",f;for(f in b){var h=b[f];if(null==c||null==h||c._OBJECTNAME==h._OBJECTNAME)a=a+d+h._OBJECTID,d=","}return a},_unassignAllAction:function(b,a){var c=b.Values.selecteddate,d=this;this.grid.ShowMessage(this.messages.pleasewait,2,3);this.fetch("async_unassign_all",
d._ioOptions({projectid:d.projectid,id:a._PARENTID,date:c})).then(function(a){if(a&&a.Changes&&a.Changes.length)for(var b=a.Changes,c=0;c<b.length;c++){var e=b[c],l=d._otherGRID.grid.GetRowById(e.id);null!=l&&(l._ASSIGNMENTCREW=e._ASSIGNMENTCREW,l._ASSIGNMENTCREWTYPE=e._ASSIGNMENTCREWTYPE,l._ASSIGNMENTSKILL=e._ASSIGNMENTSKILL,l._ASSIGNMENTCRAFT=e._ASSIGNMENTCRAFT,l._ASSIGNMENTLABOR=e._ASSIGNMENTLABOR,l._Resources=e._Resources,l.Resources=e.Resources,d._otherGRID.grid.RefreshRow(l))}d.HideTGMessage();
d.publishLater("skd.refreshAssignment",a,100,"skd.refreshAssignment")})},_viewAssignmentsAction:function(b,a){k.debug("Selected row: {}",a);addCommInput("selectedAssignments",a.EXTERNALASSIGNMENTS);addCommInput("uniqueid",a.parentNode._OBJECTID);addCommInput("actionname","view_assign");addCommInput("dialogname","view_assign");addCommInput("skdobjectname",a._OBJECTNAME);addCommInput("objectname",a._OBJECTNAME);addCommInput("eventtargetid","viewerng_resourcetabs_rshb_gantt");addCommInput("projectid",
this.projectid);k.debug("sendEvent({},{})","view_assign",this.appname);sendEvent("view_assign",this.appname,"")},_adjustCrewAssignmentsAction:function(b,a){k.debug("Selected row: {}",a);var c=b.Values.selecteddate;addCommInput("uniqueid",a.parentNode._OBJECTID);addCommInput("selectedDate",c);addCommInput("actionname","crewassign");addCommInput("dialogname","crewassign");addCommInput("skdobjectname",a._OBJECTNAME);addCommInput("objectname",a._OBJECTNAME);addCommInput("eventtargetid","viewerng_resourcetabs_rshb_gantt");
addCommInput("projectid",this.projectid);k.debug("sendEvent({},{})","crewassign",this.appname);sendEvent("crewassign",this.appname,"")},_exportAssignmentsAction:function(b,a){k.debug("Selected row: {}",a);var c=b.Values.selection,d=this.grid.GetSelRows(),f=[];for(i=0;i<d.length;i++)f.push(d[i]._OBJECTNAME);0==f.length&&f.push(a._OBJECTNAME);addCommInput("selection",c);addCommInput("objectnames",f.join());addCommInput("actionname","export_calendar");addCommInput("dialogname","export_calendar");addCommInput("skdobjectname",
a._OBJECTNAME);addCommInput("objectname",a._OBJECTNAME);addCommInput("eventtargetid","viewerng_resourcetabs_rshb_gantt");addCommInput("projectid",this.projectid);k.debug("sendEvent({},{})","export_calendar",this.appname);sendEvent("export_calendar",this.appname,"")},_modavailAction:function(b,a){var c=b.Values,d=c.selection,f=c.selecteddate;""==d&&(a._OBJECTID?d=a._OBJECTID:c.uniqueid&&(d=c.uniqueid));this._modavailrsncode(d,f,a)},_modavailrsncode:function(b,a,c){var d="LABOR"==c._OBJECTNAME||"AMCREW"==
c._OBJECTNAME;if(this.enableModAvail&&d){k.debug("Selected Row: {}",c);var d=(new Date(this.TGDateToTZDate(a))).getDay()+1,f=0;c.parentNode&&(f=c.parentNode["WORKHOURSDAY"+d]);d="WORK"==this.reasonCodes[this.selectedModAvailReasonCode];""!=this.selectedModAvailReasonCode&&"REMOVE"!=this.selectedModAvailReasonCode?"PARTIALDAY"!=this.selectedModAvailDurationType&&0<f?(f=this.GetModAvailList(c),d||f&&1<=f.length?this.openModAvailDialog(b,a,c):this._onSaveModAvailRsnCode(b,c._OBJECTNAME,a)):"FULLWEEK"==
this.selectedModAvailDurationType?(f=this.GetModAvailWeekList(c),d||0!=f.length?this.openModAvailDialog(b,a,c):this._onSaveModAvailRsnCode(b,c._OBJECTNAME,a)):this.openModAvailDialog(b,a,c):"REMOVE"==this.selectedModAvailReasonCode?this._onDeleteModAvailRsnCode(b,c._OBJECTNAME,a):(this.HideTGMessage(),this.grid.ShowMessageTime("There is no reason code specified.",0))}},shouldRightClickSelectRow:function(b,a,c){return!1},shouldDblClickSelectRow:function(b,a,c){return!0},OnDblClick:function(b,a,c,d,
f,h){this.inherited(arguments);var g="LABOR"==a._OBJECTNAME||"AMCREW"==a._OBJECTNAME,e=b.GetGanttXY(a,c,d,f);if("G"===c&&g)if(""!=this.selectedActivities){if(null!=e&&null!=e.Type&&e.RunId){var e=e.RunId,l=this.GetRowById(e),g=this.selectedActivities;""==g&&(g=a._OBJECTID);k.debug("Selected Row: {}",l);var n=l.START;(new Date(this.TGDateToTZDate(n))).getDay();this.assignAction(g,n,a)}}else g&&this.enableModAvail&&(g=this._GetSelectedObjectIds(b,c,a),""==g&&(g=a._OBJECTID),n=a.START,null!=e&&null!=
e.Type&&e.RunId&&(e=e.RunId,"FULLWEEK"==this.selectedModAvailDurationType&&(e=e.replace(/.$/,"1")),l=this.GetRowById(e),k.debug("Selected Row: {}",l),n=l.START),this._modavailrsncode(g,n,l));else"CRAFT"===c&&g&&""!=this.selectedActivities&&(g=this.selectedActivities,""==g&&(g=a._OBJECTID),this.assignResourceAction(g,a))},assignAction:function(b,a,c){var d="ASSIGNLAB";"AMCREW"==c._OBJECTNAME&&(d="CRWASSIGNA");var f=this.linkedWorkView._GetSelectedRowIds(this.linkedWorkViewGrid);addCommInput("activities",
f);addCommInput("uniqueid",c._OBJECTID);addCommInput("selection",b);addCommInput("workdate",a);addCommInput("actionname",d);addCommInput("dialogname",d);addCommInput("skdobjectname",c._OBJECTNAME);addCommInput("objectname",c._OBJECTNAME);addCommInput("eventtargetid","viewerng_resourcetabs_rshb_gantt");addCommInput("projectid",this.projectid);k.debug("sendEvent({},{})",d,this.appname);sendEvent(d,this.appname,"")},assignResourceAction:function(b,a){var c="ONLYASSIGNLAB";"AMCREW"==a._OBJECTNAME&&(c=
"ONLYCRWASSIGNA");var d=this.linkedWorkView._GetSelectedRowIds(this.linkedWorkViewGrid);addCommInput("activities",d);addCommInput("uniqueid",a._OBJECTID);addCommInput("selection",b);addCommInput("actionname",c);addCommInput("dialogname",c);addCommInput("skdobjectname",a._OBJECTNAME);addCommInput("objectname",a._OBJECTNAME);addCommInput("eventtargetid","viewerng_resourcetabs_rshb_gantt");addCommInput("projectid",this.projectid);k.debug("sendEvent({},{})",c,this.appname);sendEvent(c,this.appname,"")},
openModAvailDialog:function(b,a,c){addCommInput("selection",b);addCommInput("workdate",a);addCommInput("actionname","MODIFYMODAVAIL");addCommInput("dialogname","MODIFYMODAVAIL");addCommInput("linkedapp","MODIFYMODAVAIL");addCommInput("skdobjectname",c._OBJECTNAME);addCommInput("objectname",c._OBJECTNAME);addCommInput("eventtargetid","viewerng_resourcetabs_rshb_gantt");addCommInput("projectid",this.projectid);addCommInput("reasoncode",this.selectedModAvailReasonCode);addCommInput("durationtype",this.selectedModAvailDurationType);
k.debug("sendEvent({},{})","MODIFYMODAVAIL",this.appname);sendEvent("MODIFYMODAVAIL",this.appname,"")},attachExtraGridEvents:function(b){this.inherited(arguments);k.debug("{} Registering extra grid events",this.TAG);AddEvent("OnRowFilter",b,m.hitch(this,this.OnRowFilter));AddEvent("OnFilterFinish",b,m.hitch(this,this.OnFilterFinish));AddEvent("OnMouseOver",b,m.hitch(this,this.OnMouseOver));AddEvent("OnGetColor",b,m.hitch(this,this.OnGetColor));this.subscribeOn("skd.workview.rowselected",m.hitch(this,
this.workViewRowSelected));this.subscribeOn("skd.workview.updated",m.hitch(this,this._workviewChanged));this.subscribeOn("skd.response.workview.reference",m.hitch(this,this.onWorkViewReferenceReceived));this.subscribeOn("skd.refreshResource",m.hitch(this,this._refreshResource));this.subscribeOn("skd.cancelModAvailDialog",m.hitch(this,this._cancelModAvailDialog));this.subscribeOn("skd.workview.weekChange",m.hitch(this,this._weekChanged));this.subscribeOn("skd.workview.filtered",m.hitch(this,this.workViewFiltered))},
setResourcesToHighlight:function(b,a,c,d){"ASSIGNED"==c.STATUS?(d||a.add(c._Resources+"_"+c.ORGID+"_DAY"+(c._WorkDay+1)%7),a=null,null!=c._ASSIGNMENTCRAFT?a=c._ASSIGNMENTCRAFT:null!=c._ASSIGNMENTCREW&&(a=c._ASSIGNMENTCREW),b.add({craft:a,skillLevel:c._ASSIGNMENTSKILL})):b.add({craft:c._Resources,skillLevel:c._ASSIGNMENTSKILL})},workViewRowSelected:function(b){if(this.isVisible()&&this.initialized){var a=b.grid.GetSelRows(),c=[],d=new Set,f=new Set,h=this.grid.GetScrollLeft(2),h=this.grid.GetGanttDate(h,
"G"),g=h+6048E5;if(b.resourceFilterEnabled&&a&&0<a.length){b=[];for(var e=0;e<a.length;e++)if(void 0==a[e]._ASSIGNMENTID?void 0!=a[e]._OBJECTID&&c.push("WOID_"+a[e]._OBJECTID):c.push(a[e]._ASSIGNMENTID),a[e].Resources){b.push(this._parseResources(a[e].Resources));var l=a[e].Resources.split(",");if(l&&1<l.length)for(var n=0;n<l.length;n++)b.push(this._parseResource(l[n]));l=!a[e].startTime||!(a[e].startTime>h&&a[e].startTime<g);this.setResourcesToHighlight(d,f,a[e],l)}this.grid.__FilterResourcesData=
b;k.debug("{}: Applying Resource Filter",this.TAG,b);this.grid.SetFilter("resources","Grids.FilterResources(Grid,Row)","name",2)}else{if(a&&0<a.length)for(e=0;e<a.length;e++)void 0==a[e]._ASSIGNMENTID?c.push("WOID_"+a[e]._OBJECTID):c.push(a[e]._ASSIGNMENTID),a[e].Resources&&(l=!a[e].startTime||!(a[e].startTime>h&&a[e].startTime<g),this.setResourcesToHighlight(d,f,a[e],l));0==b.grid.GetFilter().length&&(this.grid.SetFilter("resources",null,"name",2),delete this.grid.__FilterResourcesData);k.debug("{}: Removing Resource Filter",
this.TAG);delete this.grid.__FilterResources}this._applyRelatedAssignmentsHighlight(d,f);this.selectedActivities=c;this._workViewRowSelected(c)}},_workViewRowSelected:function(b){var a=this;this.grid.ShowMessage(this.messages.pleasewait,2,3);this.fetch("async_workview_selected",a._ioOptions({selection:b})).then(function(b){a.HideTGMessage()})},OnRenderFinish:function(b){this.inherited(arguments);this.publishLater("skd.resourceview.loaded",{},100,"skd.resourceview.loaded");this.linkedWorkView=this._otherGRID;
this.linkedWorkViewGrid=this._otherGRID.grid;var a=this;this.isRefresh&&this.fetch("_gotoWeek",a._ioOptions({startWeekDay:this.currentWeek,resetWeek:!1})).then(function(b){a.grid.ReloadBody(function(){if(a.highlightedRows&&0<a.highlightedRows.length)for(var b=0;b<a.highlightedRows.length;b++){var c=a.highlightedRowsColor.get(a.highlightedRows[b]),h=a.GetRowById(a.highlightedRows[b]);null!=h&&(h.Color=c,a.grid.RefreshRow(h))}});a.grid.ZoomTo(b.startWeekDay,b.endWeekDay,1E3);a.isRefresh=!1;a.currentWeek=
null});this.state&&(this.state.WorkFilterEnabled&&(b.Toolbar.FILTERWORK=this.state.WorkFilterEnabled,b.RefreshRow(b.FILTERWORK),this.invokeLater(function(){a._enableFilterWorkAction()},100,"EnableFilterWork")),b.RefreshRow(b.Toolbar));this.initialized=!0;this.invokeLater(function(){a.linkedWorkView._ResourceFilterEnabled&&a.linkedWorkView._enableFilterResourcesAction()},100,"EnableFilterResource")},OnLoadCustomCfg:function(b,a,c){this.inherited(arguments);this._WorkFilterEnabled=this.state.WorkFilterEnabled},
OnSaveCustomCfg:function(b,a){this.state||(this.state={});b&&b.Filter&&(this.state.Filter||(this.state.Filter={}),this.state.Filter.Visible=b.Filter.Visible);this.state.WorkFilterEnabled=this._WorkFilterEnabled;var c=JSON.stringify(this.state);k.debug("Custom State",c);return c},_enableFilterWorkAction:function(){this.inherited(arguments);this.grid.SaveCfg()},_disableFilterWorkAction:function(){this.inherited(arguments);this.grid.SaveCfg()},workViewFiltered:function(b){if(this.isVisible())if(b.grid.__FilterByWork){var a=
null,c=null;0<b.grid.__FilterByWork.resources.size&&(a=Array.from(b.grid.__FilterByWork.resources));0<b.grid.__FilterByWork.crewWorkGroups.size&&(c=Array.from(b.grid.__FilterByWork.crewWorkGroups));null==a&&null==c?(k.debug("{}: Removing Resource Filter",this.TAG),this.grid.SetFilter("resources",null,"name",2),this.grid.SetFilter("resources",null,"CREWWORKGROUP",2),delete this.grid.__FilterResources,delete this.grid.__FilterResourcesData,delete this.grid.__FilterResourcesCrewWorkGroupData):(this.grid.__FilterResourcesData=
a,this.grid.__FilterResourcesCrewWorkGroupData=c,null!=a&&(k.debug("{}: Applying Resource Filter",a),this.grid.SetFilter("resources","Grids.FilterResources(Grid,Row)","name",2)),null!=c&&(k.debug("{}: Applying Resource Filter",c),this.grid.SetFilter("resources","Grids.FilterResourcesCrewWorkGroup(Grid,Row)","CREWWORKGROUP",2)),delete b.grid.__FilterByWork)}else k.debug("{}: Removing Resource Filter",this.TAG),this.grid.SetFilter("resources",null,"name",2),this.grid.SetFilter("resources",null,"CREWWORKGROUP",
2),delete this.grid.__FilterResources,delete this.grid.__FilterResourcesData,delete this.grid.__FilterResourcesCrewWorkGroupData},_workviewChanged:function(b){if(this.isVisible()||null==this.grid)if(this.reloadRequired||null==this.grid)this.reloadRequired=!1,this._createUI();else{b.isRefresh&&(this.isRefresh=b.isRefresh,this.currentWeek=b.currentWeek);k.debug("{} WORKVIEW CHANGED",this.TAG);this.lastScollTop=this.grid.GetScrollTop();var a=this;try{null!=this.lastCfg&&this.grid.LoadCfg(this.lastCfg)}catch(c){k.debug("LoadCfg error",
c)}this.linkedWorkView&&this.linkedWorkView.HideTGMessage();this.grid.ShowMessage(this.label("loading_resources"),2,3);this.grid.ReloadBody(function(){a.lastScollTop?a.invokeLater(function(){k.debug("Updating Scroll Top: {}",a.lastScollTop);a.grid.SetScrollTop(a.lastScollTop);a._updateSync()},300,"ReloadBody"):a._updateSync();if(a.linkedWorkViewGrid){var b=new Set,d=new Set,f=a.grid.GetScrollLeft(2),f=a.grid.GetGanttDate(f,"G"),h=f+6048E5,g=a.linkedWorkViewGrid.GetSelRows();if(g&&0<g.length)for(var e=
0;e<g.length;e++)a.setResourcesToHighlight(b,d,g[e],!g[e].startTime||!(g[e].startTime>f&&g[e].startTime<h));a._applyRelatedAssignmentsHighlight(b,d)}a.state&&a.state.WorkFilterEnabled&&a.invokeLater(function(){a._enableFilterWorkAction()},100,"EnableFilterWork")})}},onVisibilityChanged:function(b){k.debug("Visibility Has Changed: Visible: {}",b);b||null==this.grid?this._workviewChanged():(k.debug("Disabling Grid Sync"),this.grid.SyncId=null)},postCreate:function(){this.inherited(arguments);var b=
this;this.aspectShowHideElHandle=r.after(window,"hideShowElement",function(a,c){a&&a.querySelector&&a.querySelector("#"+b.domId)&&(k.debug("ShowHideEl: called with {}",c),b.onVisibilityChanged(b.isVisible()))},!0)},destroy:function(){this.inherited(arguments);this.aspectShowHideElHandle&&(this.aspectShowHideElHandle.remove(),this.aspectShowHideElHandle=null)},__refreshAssignment:function(b){k.debug("Do nothing here...")},OnGetGanttBarHtml:function(b,a,c,d,f,h,g,e,l,k,q,p,r){b="{name}";c="gantt."+
a._OBJECTNAME+".tpl";null!=this[c]&&(b=this[c],null==b||0==b.trim().length)&&(b="{name}");b=m.replace(b,m.hitch({row:a},this.__rowValFunc));if(null==b||0==b.trim().length)b=a.name;if(!a.IsSummary){f=d="";d=null!=a._INTERNALSTATUS?"SKD"+a._OBJECTNAME+"_"+a._INTERNALSTATUS:"SKD"+a._OBJECTNAME;this.usePriorityColors&&a.WOPRIORITY&&(d="SKD"+a._OBJECTNAME+"_PRIORITY_"+a.WOPRIORITY);c=d+"-inner";a.STATUS&&(h="SKDSYN_"+a._OBJECTNAME+"_"+a.STATUS.toString().replace(/\s+/g,"-"),d+=" "+h,c+=" "+h+"-inner");
a.ERRVAL&&(d="",0!=(a.ERRVAL&this.ERRORS.ERR_INVALID_CRAFT_SKILL)&&(d="skd-InvalidSkillMap"),0==(a.ERRVAL&this.ERRORS.ERR_CONFLICT_DOUBLE_BOOKED)&&0==(a.ERRVAL&this.ERRORS.ERR_CONFLICT_NON_WORK)||"ASSIGNED"!=a._INTERNALSTATUS||(d+=" skd-Conflict"),0!=(a.ERRVAL&this.ERRORS.ERR_SCHEDULE_WINDOW)&&(d+=" skd-err-schedule-window"),""==d&&(d+=" skd-error"));a.EXTERNALASSIGNMENTS&&null!=a.EXTERNALASSIGNMENTS&&(d+=" EXTERNALASSIGNMENTS");a._ALTCLASS&&(f=a._ALTCLASS);g=1==a._READONLY?" skd-READONLY":"";e=1==
a._READONLY_DURATION?" skd-READONLY_DURATION":"";l=1==a._READONLY_ASSIGNMENT?" skd-READONLY_ASSIGNMENT":"";k=1==a._READONLY_STARTEND?" skd-READONLY_STARTEND":"";h=this._GetAltCSSClassForActivity(a)||"";d="skd-bar "+d+" "+f+" "+h+" "+k+e+l+g;c="skd-bar-inner "+c+" "+(h?h+"-inner ":"");f=null;if(this.GetBarStyle&&(f=this.GetBarStyle(a)))return b="st-"+a.id,h=document.createElement("style"),h.type="text/css",h.innerHTML="."+b+" { "+f+" }",d+=" "+b,p||(p=[]),p[2]=d,p[3]=c,b=a.TEXT,'<div class="'+d+'" style="'+
f+'" >'+(b?b:"")+"</div>";p||(p=[]);p[2]=d;p[3]=c;null!=b&&(b=b.replace(/\|/g,"&vert;"),b=b.replace(/\'/g,"&apos;"))}return b},GetModAvailList:function(b){var a=b.DAYINDEX%7;0==a&&(a=7);var c=b.WEEK,d;b.parentNode&&(d=b.parentNode["WEEK"+c+"_MODAVAILINFO"+a])&&(d=JSON.parse(d));return d},GetModAvailWeekList:function(b){var a=b.WEEK,c=[];if(b.parentNode)for(var d=1;7>=d;d++)if(modAvailList=b.parentNode["WEEK"+a+"_MODAVAILINFO"+d])modAvailList=JSON.parse(modAvailList),c.push(modAvailList);return c},
GetBarStyle:function(b){if(b.CREWASSIGNMENT){var a;a="background: url('miniapps/scheduler/crews-scheduled.png') no-repeat left center;";a+="background-position: 3px 5px, top right;";b._ASSIGNMENTSELECTED&&(a+="border-style: dashed;",a+="border-color: red !important;",a+="border-width: 2px;",a+="margin-top: -1px!important;");return a}if(b.MODAVAILCOLOR){a="";var c=b.MODAVAILCOLOR,d=this.GetModAvailList(b);if(d){var f=d&&1<d.length;if(f)for(var c="#B03060",h=0;h<d.length;h++)d[h].fullDay&&(b.FULLDAY=
1,d[h].color&&(b.MODAVAILCOLOR=d[h].color),d[h].fontColor&&(b.MODAVAILFONTCOLOR=d[h].fontColor))}b.FULLDAY&&"OVERBOOKED"!=b._INTERNALSTATUS&&(a+="background-color: "+b.MODAVAILCOLOR+"!important;",a+="color: "+b.MODAVAILFONTCOLOR+"!important;");if(!b.FULLDAY||f)a+="background: ",b.EXTERNALASSIGNMENTS&&(a+="url('miniapps/scheduler/labor-scheduled.png') no-repeat left center, "),a+="linear-gradient(to top right,transparent 50%,"+c+" 0) top right/18px 18px no-repeat,transparent;",b.EXTERNALASSIGNMENTS&&
(a+="background-position: 3px 5px, top right;");b._ASSIGNMENTSELECTED&&(a+="border-style: dashed;",a+="border-color: red !important;",a+="border-width: 2px;",a+="margin-top: -1px!important;");return a}if(b._ASSIGNMENTSELECTED)return a="border-style: dashed;",a+="border-color: red !important;",a+="border-width: 2px;",a+="margin-top: -1px!important;"},_cancelModAvailDialog:function(){this.HideTGMessage();this.grid.ClearSelection()},_refreshResource:function(b){var a=this;try{null!=this.lastCfg&&this.grid.LoadCfg(this.lastCfg)}catch(c){k.debug("LoadCfg error",
c)}this.grid.ShowMessage(this.label("loading_resources"),2,3);this.grid.ReloadBody(function(){a.state&&a.state.WorkFilterEnabled&&a.invokeLater(function(){a._enableFilterWorkAction()},100,"EnableFilterWork")});this.clearReasonCode&&(this.selectedModAvailReasonCode="",this.grid.Toolbar.MODAVAILRSNCODE="",this.grid.RefreshRow(this.grid.Toolbar));this.selectedActivities&&(this.selectedActivities="");null!=b&&this.grid.ClearSelection()},_weekChanged:function(b){if(this.isVisible()){var a=this;this.grid.ShowMessage(this.messages.pleasewait,
2,3);this._clearHighlightedRows();this._clearHighlightedCells();var c=!1;b.resetWeek&&(c=!0);this.fetch("_gotoWeek",a._ioOptions({startWeekDay:b.startWeekDay,resetWeek:c})).then(function(c){null!=a.lastCfg&&a.grid.LoadCfg(a.lastCfg);a.grid.ShowMessage(a.label("loading_resources"),2,3);a.grid.ReloadBody(function(){if(a.linkedWorkViewGrid){var b=new Set,c=new Set,d=a.grid.GetScrollLeft(2),d=a.grid.GetGanttDate(d,"G"),e=d+6048E5,l=a.linkedWorkViewGrid.GetSelRows();if(l&&0<l.length)for(var k=0;k<l.length;k++)a.setResourcesToHighlight(b,
c,l[k],!l[k].startTime||!(l[k].startTime>d&&l[k].startTime<e));a._applyRelatedAssignmentsHighlight(b,c)}a.state&&a.state.WorkFilterEnabled&&a.invokeLater(function(){a._enableFilterWorkAction()},100,"EnableFilterWork")});a.grid.ZoomTo(b.startWeekDay,b.endWeekDay,1E3)})}},OnRowFilter:function(b,a,c){if(!this.grid.__FilterResourcesData){this.grid.__FilterByResource||(this.grid.__FilterByResource=new Set,this.grid.__FilterByResource={resources:new Set,crewWorkGroups:new Set});for(var d=[],f=0;f<b.GetFilter().length;f++)d.push(b.GetFilter()[f][0]);
1==c&&(d.includes("name")&&a.name&&""!=a.name&&this.grid.__FilterByResource.resources.add(a.name),d.includes("CREWWORKGROUP")&&a.CREWWORKGROUP&&""!=a.CREWWORKGROUP&&this.grid.__FilterByResource.crewWorkGroups.add(a.CREWWORKGROUP))}},OnFilterFinish:function(b,a){this.grid.__FilterResourcesData||(k.info("FilterBy Data: {}",this.grid.__FilterByResource),this.publishLater("skd.resourceview.filtered",{grid:b},100,"skd.resourceview.filtered"));if(this.grid.__FilterResourcesData&&0<this.highlightedRows.length)for(var c=
0;c<this.highlightedRows.length;c++){var d=this.highlightedRowsColor.get(this.highlightedRows[c]),f=this.GetRowById(this.highlightedRows[c]);null!=f&&(f.Color=d,b.RefreshRow(f))}},OnMouseOver:function(b,a,c,d,f,h){null!=Grids.Focused&&Grids.Focused.MainTag.id!=b.MainTag.id&&null!=a&&null!=Grids.Focused.GetSelRows()&&0<Grids.Focused.GetSelRows().length&&(k.info("OnMouseOver - Changing focus to bottom view"),b.ActionFocus())},_applyRelatedAssignmentsHighlight:function(b,a){k.debug("Highlighted Resources: {}",
b);k.debug("Assigned Resources: {}",a);var c=Array.from(b);this._clearHighlightedRows();this._clearHighlightedCells();if(0<c.length){var d=Object.keys(this.grid.Rows);for(i=0;i<d.length;i++){var f=this.grid.Rows[d[i]];if(f._OBJECTNAME&&!f.TEXT)for(x=0;x<c.length;x++){var h=c[x].craft,g=c[x].skillLevel;null==g&&(g="");var e=f.SECONDARYCRAFTS;null!=e&&""!=e&&(e=JSON.parse(e));var l=!1;"LABOR"==f._OBJECTNAME?f.CRAFT==h||f.PRIMARYCRAFT==h?(l=!0,f.SKILLLEVEL==g?f.Color="#64d9e7":(g=h+"-"+g,h=h+"-"+f.SKILLLEVEL,
g=this.craftSkillRank[g],h=this.craftSkillRank[h],g>=h&&(f.Color="#bceef4"))):null!=e&&null!=e[h]&&(l=!0,e=e[h],e==g?f.Color="#64d9e7":(g=h+"-"+g,h=h+"-"+e,g=this.craftSkillRank[g],h=this.craftSkillRank[h],g>=h&&(f.Color="#bceef4"))):"AMCREW"==f._OBJECTNAME&&(f.CRAFT==h||f.parentNode&&f.parentNode.CRAFT&&f.parentNode.CRAFT==h)&&(l=!0,f.Color="#64d9e7");l&&!this.highlightedRows.includes(f.id)&&(this.highlightedRows.push(f.id),this.highlightedRowsColor.set(f.id,f.Color),this.grid.RefreshRow(f))}}}else this._clearHighlightedRows();
c=Array.from(a);if(0<c.length)for(i=0;i<c.length;i++)f=this.GetRowById(c[i]),null!=f&&(f._ASSIGNMENTSELECTED||(f._ASSIGNMENTSELECTED=!0),this.highlightedCells.push(f.id));else this._clearHighlightedCells();this.grid.RefreshGantt(1)},_clearHighlightedRows:function(){for(i=0;i<this.highlightedRows.length;i++){var b=this.GetRowById(this.highlightedRows[i]);b&&(b.Color=null,this.grid.RefreshRow(b))}this.highlightedRows=[]},_clearHighlightedCells:function(){for(i=0;i<this.highlightedCells.length;i++){var b=
this.GetRowById(this.highlightedCells[i]);b&&delete b._ASSIGNMENTSELECTED}this.highlightedCells=[]},OnGetColor:function(b,a,c,d,f,h){var g=this.inherited(arguments);if("ALLOCATION"==c&&null!=a.ALLOCATION&&null!=a._OBJECTNAME){var e=a.ALLOCATION,e=e.substring(0,e.length-1),e=parseFloat(e);if(null!=this.allocationThresholds){var l=this.allocationThresholds.split(","),k=this.allocationColors.split(",");if(e>=l[0]&&e<=l[1])return""!=k[0]?k[0]:g;if(e>l[1]&&e<=l[2])return k[1];if(e>l[2]&&e<=l[3])return k[2];
if(e>l[3])return k[3]}}return g},_showLegendDialogAction:function(){var b=this,a=this.label("reasonCode"),c=this.label("allocation"),d=this.label("closeButton");this.label("work");this.label("nonWork");var f=this.allocationThresholds.split(","),h=this.allocationColors.split(","),g="<table style='border-spacing: 5px;'>",g=g+("<tr><td colspan='3' style='text-align:center;'><b>"+a+"</b></td></tr>"),g=g+"<tr><td colspan='3'>&nbsp;</td></tr>";Object.keys(this.reasonCodeColors).forEach(function(a){g+="<tr><td>"+
a+":<td><td style='width: 35%; border: 1px solid black; background-color: "+b.reasonCodeColors[a]+";'>&nbsp;</td></tr>"});g+="<tr><td colspan='3'>&nbsp;</td></tr>";g+="<tr><td colspan='3' style='text-align:center;'><b>"+c+"</b></td></tr>";g+="<tr><td colspan='3'>&nbsp;</td></tr>";""!=h[0]&&(g+="<tr><td>&ge; "+f[0]+"<td><td style='width: 35%; border: 1px solid black; background-color: "+h[0]+";'>&nbsp;</td></tr>");g+="<tr><td>&ge; "+f[1]+"<td><td style='width: 35%; border: 1px solid black; background-color: "+
h[1]+";'>&nbsp;</td></tr>";g+="<tr><td>&ge; "+f[2]+"<td><td style='width: 35%; border: 1px solid black; background-color: "+h[2]+";'>&nbsp;</td></tr>";g+="<tr><td>&ge; "+f[3]+"<td><td style='width: 35%; border: 1px solid black; background-color: "+h[3]+";'>&nbsp;</td></tr>";g+="<tr><td colspan='3'>&nbsp;</td></tr>";g+="<tr><td colspan='3' style='text-align:center;'><input type='button' value='"+d+"' onclick='Grids.forEach(g=>g ? g.CloseDialog() : null);' /></td></tr>";this.grid.CloseDialog();var e=
window.outerHeight/4,k=window.innerWidth/2,b=this;this.invokeLater(function(){b.grid.Dialog=ShowDialog(g,{X:k,Y:e})},100,"ShowLegend")}})});
